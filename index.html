<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Suncare POG Lookup</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  var pdfjsLib = window['pdfjs-dist/build/pdf'];
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>
<style>
:root {
  --bg: #0e1117;
  --surface: #161b22;
  --surface2: #1c2230;
  --border: #2a3140;
  --text: #e6edf3;
  --text-dim: #8b949e;
  --accent: #f0a500;
  --accent-dim: rgba(240,165,0,0.15);
  --new-badge: #2ea043;
  --move-badge: #58a6ff;
  --srp-badge: #d2a8ff;
  --seg1: #ff6b6b;
  --seg2: #4ecdc4;
  --seg3: #45b7d1;
  --seg4: #f7dc6f;
  --highlight: rgba(240,165,0,0.35);
  --radius: 10px;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  -webkit-tap-highlight-color: transparent;
  overflow-x: hidden;
}

/* Header */
.header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(14,17,23,0.92);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 12px 16px;
}
.header-top {
  display: flex; align-items: center; justify-content: space-between;
}
.header h1 {
  font-size: 15px; font-weight: 700; color: var(--accent);
  letter-spacing: 0.5px;
}
.header .subtitle {
  font-size: 11px; color: var(--text-dim); margin-top: 2px;
  font-family: 'JetBrains Mono', monospace;
}
.pog-info {
  font-size: 10px; color: var(--text-dim); text-align: right;
  font-family: 'JetBrains Mono', monospace; line-height: 1.4;
}

/* Mode Tabs */
.mode-tabs {
  display: flex; gap: 6px; padding: 10px 16px 8px;
  background: rgba(14,17,23,0.92);
  backdrop-filter: blur(12px);
  position: sticky; top: 68px; z-index: 99;
}
.mode-tab {
  flex: 1; padding: 10px 8px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text-dim);
  font-size: 13px; font-weight: 600;
  cursor: pointer; text-align: center;
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.mode-tab.active {
  background: var(--accent-dim);
  border-color: var(--accent);
  color: var(--accent);
}
.mode-tab svg { width: 16px; height: 16px; }

/* Search / Manual Entry */
.search-bar {
  padding: 8px 16px 12px;
  position: sticky; top: 118px; z-index: 98;
  background: rgba(14,17,23,0.92);
  backdrop-filter: blur(12px);
}
.search-input-wrap {
  display: flex; gap: 8px;
}
.search-input-wrap input {
  flex: 1; padding: 12px 14px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  font-size: 16px;
  font-family: 'JetBrains Mono', monospace;
  outline: none;
}
.search-input-wrap input:focus {
  border-color: var(--accent);
}
.search-input-wrap input::placeholder {
  color: var(--text-dim); font-family: 'DM Sans', sans-serif; font-size: 14px;
}
.search-btn {
  padding: 12px 18px;
  background: var(--accent);
  border: none; border-radius: var(--radius);
  color: #000; font-weight: 700; font-size: 14px;
  cursor: pointer;
}

/* Partial UPC search results */
.search-results {
  display: none;
  max-height: 320px;
  overflow-y: auto;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-top: 8px;
}
.search-results.visible { display: block; }
.search-results-header {
  padding: 8px 14px;
  font-size: 12px;
  color: var(--text-dim);
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0;
  background: var(--surface);
  z-index: 1;
}
.search-result-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  cursor: pointer;
  border-bottom: 1px solid rgba(42,49,64,0.5);
  transition: background 0.15s;
}
.search-result-item:last-child { border-bottom: none; }
.search-result-item:active,
.search-result-item:hover { background: var(--surface2); }
.search-result-img {
  width: 40px; height: 40px;
  background: #fff;
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  overflow: hidden;
}
.search-result-img img { width: 100%; height: 100%; object-fit: contain; }
.search-result-img .mini-placeholder { font-size: 18px; }
.search-result-info { flex: 1; min-width: 0; }
.search-result-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.search-result-upc {
  font-size: 11px;
  color: var(--text-dim);
  font-family: 'JetBrains Mono', monospace;
}
.search-result-upc .upc-match {
  color: var(--accent);
  font-weight: 700;
}
.search-result-loc {
  font-size: 11px;
  color: var(--text-dim);
  white-space: nowrap;
}
.search-no-results {
  padding: 16px 14px;
  text-align: center;
  font-size: 13px;
  color: var(--text-dim);
}

/* Scanner */
.scanner-section {
  padding: 16px;
  display: none;
}
.scanner-section.visible { display: block; }
#scanner-container {
  width: 100%;
  max-width: 400px;
  margin: 0 auto;
  border-radius: var(--radius);
  overflow: hidden;
  border: 2px solid var(--accent);
}
#scanner-container video { border-radius: var(--radius); }
.scanner-status {
  text-align: center; padding: 12px;
  font-size: 13px; color: var(--text-dim);
}
.scanner-controls {
  display: flex; gap: 8px; justify-content: center; margin-top: 12px;
}
.scanner-controls button {
  padding: 10px 20px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  font-size: 13px; font-weight: 600;
  cursor: pointer;
}
.scanner-controls button.primary {
  background: var(--accent); color: #000; border-color: var(--accent);
}

/* Product Result Overlay */
.result-overlay {
  display: none;
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(8px);
  z-index: 200;
  overflow-y: auto;
  padding: 20px 16px;
}
.result-overlay.visible { display: flex; flex-direction: column; align-items: center; }
.result-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  max-width: 420px;
  width: 100%;
  overflow: hidden;
}
.result-close {
  position: absolute; top: 16px; right: 16px;
  width: 40px; height: 40px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 50%;
  color: var(--text);
  font-size: 20px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
.result-image-wrap {
  background: #fff;
  display: flex; align-items: center; justify-content: center;
  min-height: 200px;
  position: relative;
}
.result-image-wrap img {
  max-height: 220px; max-width: 90%; object-fit: contain;
}
.result-placeholder {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 30px;
  color: #666; font-size: 13px; text-align: center;
}
.result-placeholder .icon { font-size: 48px; margin-bottom: 8px; opacity: 0.4; }
.result-body { padding: 20px; }
.result-name {
  font-size: 18px; font-weight: 700; margin-bottom: 4px;
  line-height: 1.3;
}
.result-upc {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px; color: var(--text-dim);
  margin-bottom: 16px;
}
.result-badges {
  display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px;
}
.badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 11px; font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.badge-new { background: rgba(46,160,67,0.2); color: var(--new-badge); }
.badge-move { background: rgba(88,166,255,0.2); color: var(--move-badge); }
.badge-srp { background: rgba(210,168,255,0.2); color: var(--srp-badge); }

.location-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
  margin-bottom: 20px;
}
.loc-item {
  background: var(--surface2);
  border-radius: 8px;
  padding: 12px;
  text-align: center;
}
.loc-label {
  font-size: 10px; color: var(--text-dim);
  text-transform: uppercase; letter-spacing: 1px;
  margin-bottom: 4px;
}
.loc-value {
  font-size: 22px; font-weight: 700;
  font-family: 'JetBrains Mono', monospace;
}
.loc-value.seg1 { color: var(--seg1); }
.loc-value.seg2 { color: var(--seg2); }
.loc-value.seg3 { color: var(--seg3); }
.loc-value.seg4 { color: var(--seg4); }

/* Mini Planogram in Result */
.mini-pog {
  background: var(--bg);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}
.mini-pog-title {
  font-size: 11px; color: var(--text-dim);
  text-transform: uppercase; letter-spacing: 1px;
  margin-bottom: 10px; text-align: center;
}
.mini-shelf {
  display: flex; gap: 2px; margin-bottom: 3px;
  align-items: stretch;
}
.mini-shelf-label {
  font-size: 9px; color: var(--text-dim);
  width: 14px; display: flex; align-items: center;
  font-family: 'JetBrains Mono', monospace;
}
.mini-slot {
  height: 22px;
  border-radius: 3px;
  background: var(--surface2);
  border: 1px solid var(--border);
  transition: all 0.3s;
  position: relative;
}
.mini-slot.highlighted {
  background: var(--accent) !important;
  border-color: var(--accent) !important;
  box-shadow: 0 0 10px rgba(240,165,0,0.5);
  animation: pulse-glow 1.5s ease-in-out infinite;
}
@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 8px rgba(240,165,0,0.4); }
  50% { box-shadow: 0 0 16px rgba(240,165,0,0.7); }
}

/* Browse Grid - v3 */
.browse-section { padding: 0 12px 80px; overflow: hidden; }
/* Shelf sections */
.shelf-section { margin-bottom: 16px; position: relative; }
.shelf-header {
  font-size: 12px; font-weight: 700;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 10px 4px 6px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 8px;
  display: flex; align-items: center; gap: 8px;
}
.shelf-header .shelf-num {
  background: var(--surface2);
  padding: 2px 8px;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
}

.product-grid {
  display: grid;
  width: 100%;
  box-sizing: border-box;
}
.facing-group-wrap {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  min-width: 0;
  overflow: hidden;
  padding: 0 1px;
}
.facing-group {
  display: flex;
  flex-direction: column;
  cursor: pointer;
  border-radius: 6px;
  border: 1px solid var(--border);
  overflow: hidden;
  transition: border-color 0.2s;
  background: var(--surface);
  width: 100%;
  min-width: 0;
}
.facing-group:active {
  border-color: var(--accent);
}
.facing-images {
  display: flex;
  background: #fff;
  border-radius: 5px 5px 0 0;
}
.facing-img-slot {
  flex: 1;
  position: relative;
  overflow: hidden;
  border-right: 1px dashed rgba(240,165,0,0.25);
  min-width: 0;
}
.facing-img-slot::before {
  content: '';
  display: block;
  padding-top: 115%;
}
.facing-img-slot img,
.facing-img-slot .placeholder-icon,
.facing-img-slot .img-loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.facing-img-slot:last-child { border-right: none; }
.facing-img-slot img {
  max-height: 90%;
  max-width: 88%;
  object-fit: contain;
}
.facing-img-slot .placeholder-icon {
  font-size: clamp(10px, 2vw, 20px); opacity: 0.3;
}
.facing-info {
  padding: 2px 3px 3px;
  width: 100%;
  min-width: 0;
  overflow: hidden;
}
.facing-info .card-name {
  font-size: clamp(6px, 1.6vw, 12px);
  font-weight: 600;
  line-height: 1.2;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  color: var(--text);
  word-break: break-word;
}
.facing-info .card-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1px;
  gap: 2px;
  min-width: 0;
}
.facing-info .card-pos {
  font-size: clamp(5px, 1.2vw, 9px);
  font-family: 'JetBrains Mono', monospace;
  color: var(--text-dim);
  white-space: nowrap;
}
.facing-info .card-upc {
  font-size: clamp(4.5px, 1vw, 8px);
  font-family: 'JetBrains Mono', monospace;
  color: var(--text-dim);
  opacity: 0.7;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
}
/* Badge row below card */
.facing-badge-row {
  display: flex;
  gap: 2px;
  justify-content: center;
  margin-top: 2px;
}
.mini-badge {
  font-size: clamp(5px, 1.1vw, 8px);
  font-weight: 700;
  padding: 1px 4px;
  border-radius: 3px;
  text-transform: uppercase;
}
.mini-badge.new-b { background: var(--new-badge); color: #fff; }
.mini-badge.srp-b { background: var(--srp-badge); color: #000; }



/* Not Found */
.not-found {
  text-align: center; padding: 40px 20px;
}
.not-found .nf-icon { font-size: 48px; opacity: 0.4; margin-bottom: 12px; }
.not-found .nf-text { font-size: 15px; color: var(--text-dim); }
.not-found .nf-upc {
  font-family: 'JetBrains Mono', monospace;
  font-size: 14px; color: var(--accent); margin-top: 8px;
}

/* Filter bar */
.filter-bar {
  display: flex; gap: 6px; padding: 4px 4px 8px;
  flex-wrap: wrap;
}
.filter-chip {
  padding: 5px 10px;
  border-radius: 16px;
  font-size: 11px; font-weight: 600;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text-dim);
  transition: all 0.2s;
}
.filter-chip.active {
  background: var(--accent-dim);
  border-color: var(--accent);
  color: var(--accent);
}

/* Scroll to top */
.scroll-top {
  position: fixed; bottom: 72px; right: 16px;
  width: 40px; height: 40px;
  background: var(--accent);
  border: none; border-radius: 50%;
  color: #000; font-size: 18px;
  cursor: pointer;
  z-index: 99;
  display: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

/* Bottom Nav Bar */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 56px;
  background: rgba(14,17,23,0.96);
  backdrop-filter: blur(16px);
  border-top: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 0 24px;
  z-index: 200;
}
.nav-side-btn {
  width: 48px; height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  font-size: 18px;
  font-weight: 800;
  font-family: 'JetBrains Mono', monospace;
  cursor: pointer;
  border: 2px solid var(--border);
  background: var(--surface);
  color: var(--text-dim);
  transition: all 0.2s;
}
.nav-side-btn.active {
  color: #000;
  border-color: transparent;
  transform: scale(1.1);
  box-shadow: 0 2px 12px rgba(0,0,0,0.3);
}
.nav-side-btn[data-seg="1"].active { background: var(--seg1); }
.nav-side-btn[data-seg="2"].active { background: var(--seg2); }
.nav-side-btn[data-seg="3"].active { background: var(--seg3); }
.nav-side-btn[data-seg="4"].active { background: var(--seg4); }

/* Bay Toast */
.bay-toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: rgba(14,17,23,0.92);
  backdrop-filter: blur(12px);
  border: 2px solid var(--accent);
  border-radius: 16px;
  padding: 16px 32px;
  font-size: 18px;
  font-weight: 800;
  color: var(--accent);
  text-align: center;
  z-index: 300;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s, transform 0.2s;
}
.bay-toast.visible {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

/* Swipe edge resistance indicator */
.swipe-edge-indicator {
  position: fixed;
  top: 0; bottom: 56px;
  width: 6px;
  background: var(--accent);
  opacity: 0;
  z-index: 150;
  pointer-events: none;
  transition: opacity 0.15s;
  border-radius: 0 3px 3px 0;
}
.swipe-edge-indicator.left { left: 0; }
.swipe-edge-indicator.right { right: 0; left: auto; border-radius: 3px 0 0 3px; }
.swipe-edge-indicator {
  display: none;
  align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  z-index: 50;
}
.swipe-edge-indicator.visible { opacity: 0.7; }
.scroll-top.visible { display: flex; }

/* Loading spinner for images */
.img-loading {
  width: 24px; height: 24px;
  border: 2px solid #ddd;
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Responsive */
@media (min-width: 600px) {
  .facing-info .card-name { -webkit-line-clamp: 3; line-clamp: 3; }
}
@media (min-width: 900px) {
  .facing-info .card-name { -webkit-line-clamp: 3; line-clamp: 3; }
}

/* ===== SMALL MOBILE OPTIMIZATION ‚Äî image-first layout ===== */

/* Small phones (under 480px wide) */
@media (max-width: 480px) {
  /* --- Compact header: single row, minimal padding --- */
  .header {
    padding: 6px 10px;
  }
  .header h1 {
    font-size: 12px;
  }
  .header .subtitle {
    font-size: 9px;
    margin-top: 1px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 52vw;
  }
  .pog-info {
    font-size: 8px;
    line-height: 1.3;
  }
  .change-display-btn {
    display: none;
  }

  /* --- Compact mode tabs --- */
  .mode-tabs {
    padding: 4px 10px 4px;
    gap: 4px;
    top: 44px;
  }
  .mode-tab {
    padding: 6px 4px;
    font-size: 11px;
    gap: 4px;
  }
  .mode-tab svg {
    width: 13px;
    height: 13px;
  }

  /* --- Search bar repositioned --- */
  .search-bar {
    top: 80px;
    padding: 4px 10px 6px;
  }

  /* --- Compact filter bar --- */
  .filter-bar {
    padding: 2px 2px 4px;
    gap: 4px;
  }
  .filter-chip {
    padding: 3px 8px;
    font-size: 10px;
  }

  /* --- Browse: tighten padding --- */
  .browse-section {
    padding: 0 4px 64px;
  }

  /* --- Shelf headers: compact --- */
  .shelf-header {
    font-size: 10px;
    padding: 4px 4px 3px;
    margin-bottom: 4px;
    letter-spacing: 0.5px;
  }
  .shelf-section {
    margin-bottom: 8px;
  }

  /* --- HIDE TEXT below product images for image-first view --- */
  .facing-info {
    padding: 1px 2px 2px;
  }
  .facing-info .card-name {
    font-size: clamp(5px, 1.4vw, 9px);
    -webkit-line-clamp: 1;
    line-clamp: 1;
  }
  .facing-info .card-meta {
    margin-top: 0;
  }
  .facing-info .card-upc {
    display: none;
  }
  .facing-info .card-pos {
    font-size: clamp(4px, 1.1vw, 7px);
  }

  /* --- Product cards: less border/gap overhead --- */
  .facing-group-wrap {
    padding: 0;
  }
  .facing-group {
    border-radius: 4px;
    border-width: 1px;
  }

  /* --- Badges: smaller --- */
  .mini-badge {
    font-size: clamp(4px, 0.9vw, 7px);
    padding: 0px 3px;
  }
  .facing-badge-row {
    margin-top: 1px;
    gap: 1px;
  }

  /* --- Bottom nav: shorter --- */
  .bottom-nav {
    height: 44px;
    padding: 0 16px;
    gap: 6px;
  }
  .nav-side-btn {
    width: 40px;
    height: 32px;
    font-size: 16px;
    border-radius: 8px;
  }
  .scroll-top {
    bottom: 52px;
    width: 34px;
    height: 34px;
    font-size: 16px;
  }
}

/* Very small phones (under 380px wide, e.g. iPhone SE, Galaxy A series) */
@media (max-width: 380px) {
  .header {
    padding: 4px 8px;
  }
  .header h1 {
    font-size: 11px;
  }
  .header .subtitle {
    font-size: 8px;
    max-width: 46vw;
  }
  .pog-info {
    font-size: 7px;
  }
  .mode-tabs {
    padding: 3px 8px 3px;
    top: 38px;
  }
  .mode-tab {
    padding: 5px 2px;
    font-size: 10px;
    gap: 3px;
    border-radius: 6px;
  }
  .mode-tab svg {
    width: 11px;
    height: 11px;
  }
  .search-bar {
    top: 70px;
  }

  /* Hide text entirely ‚Äî images only */
  .facing-info {
    display: none;
  }
  .facing-badge-row {
    display: none;
  }

  /* Maximize image space */
  .facing-img-slot::before {
    padding-top: 105%;
  }
  .facing-img-slot img {
    max-height: 94%;
    max-width: 94%;
  }

  .browse-section {
    padding: 0 2px 52px;
  }
  .shelf-header {
    font-size: 9px;
    padding: 3px 2px 2px;
    margin-bottom: 2px;
  }
  .shelf-section {
    margin-bottom: 4px;
  }

  .bottom-nav {
    height: 40px;
    gap: 5px;
    padding: 0 12px;
  }
  .nav-side-btn {
    width: 36px;
    height: 28px;
    font-size: 14px;
    border-width: 1px;
  }
  .scroll-top {
    bottom: 46px;
  }
}

/* Short screens (landscape or very short phones) ‚Äî reclaim vertical space */
@media (max-height: 700px) and (max-width: 480px) {
  .header {
    padding: 3px 8px;
  }
  .header h1 {
    font-size: 11px;
  }
  .header .subtitle {
    display: none;
  }
  .pog-info {
    font-size: 7px;
  }
  .change-display-btn {
    display: none;
  }
  .mode-tabs {
    padding: 2px 8px;
    top: 30px;
  }
  .mode-tab {
    padding: 4px 2px;
    font-size: 10px;
  }
  .search-bar {
    top: 60px;
    padding: 2px 8px 4px;
  }
  .facing-info {
    display: none;
  }
  .facing-badge-row {
    display: none;
  }
  .facing-img-slot::before {
    padding-top: 100%;
  }
  .bottom-nav {
    height: 36px;
  }
  .nav-side-btn {
    width: 34px;
    height: 26px;
    font-size: 13px;
  }
}

/* Result overlay: larger image on small screens */
@media (max-width: 480px) {
  .result-overlay {
    padding: 10px 8px;
  }
  .result-image-wrap {
    min-height: 180px;
  }
  .result-image-wrap img {
    max-height: 260px;
    max-width: 95%;
  }
  .result-body {
    padding: 14px;
  }
  .result-name {
    font-size: 16px;
  }
  .location-grid {
    gap: 6px;
    margin-bottom: 14px;
  }
  .loc-item {
    padding: 8px;
  }
  .loc-label {
    font-size: 9px;
  }
  .loc-value {
    font-size: 18px;
  }
  .mini-pog {
    padding: 8px;
    margin-bottom: 8px;
  }
}

/* Store Selector Screen */
.selector-screen {
  min-height: 100dvh;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 24px 16px;
  background: var(--bg);
}
.selector-screen.hidden { display: none; }
.selector-logo {
  font-size: 28px; font-weight: 700; color: var(--accent);
  margin-bottom: 4px; text-align: center;
}
.selector-sub {
  font-size: 13px; color: var(--text-dim); margin-bottom: 32px;
  text-align: center; font-family: 'JetBrains Mono', monospace;
}
.selector-cards {
  display: flex; flex-direction: column; gap: 16px;
  width: 100%; max-width: 400px;
}
.selector-card {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.selector-card:active {
  transform: scale(0.97);
  border-color: var(--accent);
  background: var(--accent-dim);
}
.selector-card-name {
  font-size: 18px; font-weight: 700; color: var(--text);
  margin-bottom: 4px;
}
.selector-card-sub {
  font-size: 11px; color: var(--text-dim);
  font-family: 'JetBrains Mono', monospace;
  margin-bottom: 12px; line-height: 1.4;
}
.selector-card-stats {
  display: flex; gap: 16px;
}
.selector-stat {
  font-size: 12px; color: var(--text-dim);
}
.selector-stat strong {
  color: var(--accent); font-size: 18px; display: block;
  margin-bottom: 2px;
}
.selector-dropdown-wrap {
  width: 100%; max-width: 400px;
}
.selector-dropdown-wrap select {
  width: 100%; padding: 14px 16px;
  background: var(--surface); color: var(--text);
  border: 2px solid var(--border); border-radius: 12px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 15px; cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238b949e' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
}
.selector-dropdown-wrap select:focus {
  outline: none; border-color: var(--accent);
}
.selector-preview {
  width: 100%; max-width: 400px;
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  margin-top: 12px;
  animation: fadeIn 0.2s ease;
}
.selector-preview.hidden { display: none; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
.selector-go-btn {
  width: 100%; margin-top: 16px; padding: 14px;
  background: var(--accent); color: #000;
  border: none; border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 15px; font-weight: 700;
  cursor: pointer; transition: opacity 0.2s;
}
.selector-go-btn:active { opacity: 0.8; }
.change-display-btn {
  background: none; border: 1px solid var(--border);
  color: var(--text-dim); font-size: 10px; font-weight: 600;
  padding: 4px 8px; border-radius: 6px; cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.2s; margin-top: 4px;
}
.change-display-btn:active {
  border-color: var(--accent); color: var(--accent);
}
.redirect-banner {
  background: rgba(255, 193, 7, 0.15);
  border: 1px solid #ffc107;
  border-radius: 8px;
  padding: 10px 12px;
  margin-bottom: 12px;
  font-size: 12px;
  color: #ffc107;
  line-height: 1.5;
  font-family: 'JetBrains Mono', monospace;
}
.app-content.hidden { display: none; }

/* PDF View Button */
.pdf-view-btn {
  margin-left: auto;
  padding: 5px 12px;
  border-radius: 16px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid var(--accent);
  background: var(--accent-dim);
  color: var(--accent);
  font-family: 'DM Sans', sans-serif;
  display: flex;
  align-items: center;
  gap: 4px;
  transition: all 0.2s;
  white-space: nowrap;
}
.pdf-view-btn:active {
  background: var(--accent);
  color: #000;
}

/* PDF Viewer Overlay */
.pdf-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--bg);
  z-index: 300;
  flex-direction: column;
}
.pdf-overlay.visible {
  display: flex;
}
.pdf-toolbar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
  min-height: 48px;
}
.pdf-toolbar-btn {
  width: 36px; height: 36px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: all 0.2s;
}
.pdf-toolbar-btn:active {
  background: var(--accent-dim);
  border-color: var(--accent);
  color: var(--accent);
}
.pdf-close-btn {
  background: rgba(255,80,80,0.15);
  border-color: rgba(255,80,80,0.3);
  color: #ff6b6b;
}
.pdf-close-btn:active {
  background: #ff6b6b;
  color: #fff;
}
.pdf-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
}
.pdf-page-info {
  font-size: 11px;
  font-family: 'JetBrains Mono', monospace;
  color: var(--text-dim);
  white-space: nowrap;
}
.pdf-toolbar-spacer { flex: 1; }
.pdf-zoom-level {
  font-size: 11px;
  font-family: 'JetBrains Mono', monospace;
  color: var(--accent);
  min-width: 40px;
  text-align: center;
}
.pdf-search-bar {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.pdf-search-bar input {
  flex: 1;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 12px;
  color: var(--text);
  font-size: 13px;
  font-family: 'DM Sans', sans-serif;
  outline: none;
}
.pdf-search-bar input:focus { border-color: var(--accent); }
.pdf-search-bar input::placeholder { color: var(--text-dim); }
.pdf-search-count {
  font-size: 11px;
  font-family: 'JetBrains Mono', monospace;
  color: var(--text-dim);
  white-space: nowrap;
  min-width: 50px;
  text-align: center;
}
.pdf-search-nav-btn {
  width: 32px; height: 32px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text-dim);
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.pdf-search-nav-btn:active {
  border-color: var(--accent);
  color: var(--accent);
}
.pdf-canvas-container {
  flex: 1;
  overflow: auto;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  -webkit-overflow-scrolling: touch;
}
.pdf-canvas-container canvas {
  display: block;
  margin: 0 auto;
}
.pdf-loading {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
}
.pdf-search-highlights {
  position: absolute;
  top: 0; left: 0;
  pointer-events: none;
  overflow: hidden;
}
.pdf-search-highlight {
  position: absolute;
  background: rgba(240, 165, 0, 0.35);
  border-radius: 2px;
  pointer-events: none;
}
.pdf-search-highlight.active {
  background: rgba(240, 165, 0, 0.7);
  outline: 2px solid var(--accent);
}
.pdf-nav-bar {
  display: flex;
  gap: 8px;
  padding: 8px 16px;
  background: var(--surface);
  border-top: 1px solid var(--border);
  flex-shrink: 0;
  padding-bottom: max(8px, env(safe-area-inset-bottom));
}
.pdf-nav-btn {
  flex: 1;
  padding: 10px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 14px;
  font-weight: 600;
  font-family: 'DM Sans', sans-serif;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s;
}
.pdf-nav-btn:active {
  background: var(--accent-dim);
  border-color: var(--accent);
  color: var(--accent);
}
.pdf-nav-btn:disabled {
  opacity: 0.3;
  pointer-events: none;
}
</style>
</head>
<body>

<!-- Store Selector Screen -->
<div class="selector-screen" id="selector-screen">
  <div class="selector-logo">‚òÄÔ∏è SUNCARE POG LOOKUP</div>
  <div class="selector-sub">Select your store to begin</div>
  <div class="selector-cards">
    <div class="selector-dropdown-wrap">
      <select id="store-select" onchange="onStoreSelect(this.value)">
        <option value="" disabled selected>Choose store...</option>
      </select>
    </div>
    <div class="selector-preview hidden" id="selector-preview">
      <div class="selector-card-name" id="preview-name"></div>
      <div class="selector-card-sub" id="preview-sub"></div>
      <div class="selector-card-stats" id="preview-stats"></div>
      <button class="selector-go-btn" id="selector-go-btn" onclick="confirmStoreSelect()">Load Planogram ‚Üí</button>
    </div>
  </div>
</div>

<!-- App Content (hidden until planogram selected) -->
<div class="app-content hidden" id="app-content">

<div class="header">
  <div class="header-top">
    <div>
      <h1>‚òÄÔ∏è SUNCARE POG LOOKUP</h1>
      <div class="subtitle" id="header-subtitle">185-SUNTAN 680 ¬∑ HP 62IN ¬∑ 5-Shelf Pallet</div>
    </div>
    <div class="pog-info" id="header-pog-info">
      LIVE 02-08-26<br>
      170 SKUs ¬∑ 4 Sides
    </div>
  </div>
  <button class="change-display-btn" onclick="showSelector()">‚Ü© Change Store</button>
</div>

<div class="mode-tabs">
  <div class="mode-tab active" data-mode="browse" onclick="setMode('browse')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
    Browse
  </div>
  <div class="mode-tab" data-mode="scan" onclick="setMode('scan')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7V5a2 2 0 012-2h2M17 3h2a2 2 0 012 2v2M21 17v2a2 2 0 01-2 2h-2M7 21H5a2 2 0 01-2-2v-2"/><line x1="7" y1="12" x2="17" y2="12"/></svg>
    Scan
  </div>
  <div class="mode-tab" data-mode="manual" onclick="setMode('manual')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    UPC
  </div>
</div>

<div class="search-bar" id="search-bar" style="display:none;">
  <div class="search-input-wrap">
    <input type="text" id="upc-input" inputmode="numeric" placeholder="Search UPC (full or last 4+ digits)..." maxlength="14">
    <button class="search-btn" onclick="lookupUPC()">GO</button>
  </div>
  <div class="search-results" id="search-results"></div>
</div>

<div class="scanner-section" id="scanner-section">
  <div id="scanner-container"></div>
  <div class="scanner-status" id="scanner-status">Tap "Start Camera" to begin scanning</div>
  <div class="scanner-controls">
    <button class="primary" id="scanner-toggle" onclick="toggleScanner()">Start Camera</button>
  </div>
</div>

<div class="browse-section" id="browse-section">
  <div class="filter-bar">
    <div class="filter-chip active" data-filter="all" onclick="setFilter('all')">All</div>
    <div class="filter-chip" data-filter="new" onclick="setFilter('new')">üü¢ New</div>
    <div class="filter-chip" data-filter="srp" onclick="setFilter('srp')">üü£ SRP</div>
    <button class="pdf-view-btn" id="pdf-view-btn" onclick="openPdfViewer()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      PDF
    </button>
  </div>
  <div id="shelf-container"></div>
</div>

<div class="result-overlay" id="result-overlay">
  <button class="result-close" onclick="closeResult()">‚úï</button>
  <div class="result-card" id="result-card"></div>

<!-- PDF Viewer Overlay -->
<div class="pdf-overlay" id="pdf-overlay">
  <div class="pdf-toolbar">
    <button class="pdf-toolbar-btn pdf-close-btn" onclick="closePdfViewer()" title="Close">‚úï</button>
    <div class="pdf-title" id="pdf-title">PDF Viewer</div>
    <div class="pdf-toolbar-spacer"></div>
    <div class="pdf-page-info" id="pdf-page-info">1 / 1</div>
    <button class="pdf-toolbar-btn" onclick="pdfZoomOut()" title="Zoom Out">‚àí</button>
    <span class="pdf-zoom-level" id="pdf-zoom-level">100%</span>
    <button class="pdf-toolbar-btn" onclick="pdfZoomIn()" title="Zoom In">+</button>
  </div>
  <div class="pdf-search-bar">
    <input type="text" id="pdf-search-input" placeholder="Search in PDF..." oninput="pdfSearchDebounce()">
    <span class="pdf-search-count" id="pdf-search-count"></span>
    <button class="pdf-search-nav-btn" onclick="pdfSearchPrev()" title="Previous">‚ñ≤</button>
    <button class="pdf-search-nav-btn" onclick="pdfSearchNext()" title="Next">‚ñº</button>
  </div>
  <div class="pdf-canvas-container" id="pdf-canvas-container">
    <div class="pdf-loading" id="pdf-loading">
      <div class="img-loading"></div>
      <div style="margin-top:12px; color:var(--text-dim); font-size:13px;">Loading PDF...</div>
    </div>
    <canvas id="pdf-canvas"></canvas>
    <div class="pdf-search-highlights" id="pdf-search-highlights"></div>
  </div>
  <div class="pdf-nav-bar">
    <button class="pdf-nav-btn" id="pdf-prev-btn" onclick="pdfPrevPage()">‚Äπ Prev</button>
    <button class="pdf-nav-btn" id="pdf-next-btn" onclick="pdfNextPage()">Next ‚Ä∫</button>
  </div>
</div>

</div>

<button class="scroll-top" id="scroll-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë</button>

<!-- Bottom Nav Bar -->
<nav class="bottom-nav" id="bottom-nav">
  <div class="nav-side-btn active" data-seg="1" onclick="setSegment(1)">1</div>
  <div class="nav-side-btn" data-seg="2" onclick="setSegment(2)">2</div>
  <div class="nav-side-btn" data-seg="3" onclick="setSegment(3)">3</div>
  <div class="nav-side-btn" data-seg="4" onclick="setSegment(4)">4</div>
</nav>

<!-- Bay change toast -->
<div class="bay-toast" id="bay-toast"></div>

<!-- Swipe edge indicator -->
<div class="swipe-edge-indicator" id="swipe-edge"></div>

</div><!-- /app-content -->
<script>
// Product images loaded from .webp files in same directory

const PLANOGRAMS = {
  "pallet": {
    id: "pallet",
    name: "4-Sided Pallet",
    subtitle: "HP 62IN SUNCARE 5 SHELF 1 PEG 4 SIDED PALLET",
    pogNumber: "185-SUNTAN 680",
    liveDate: "02-08-26",
    sides: 4,
    shelves: 5,
    pdfFile: "4-sided-pallet.pdf",
    products: [
{"upc":"0008680068785","name":"Neutrogena Ultra Sheer Sunblock SPF 30","segment":1,"shelf":1,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0008680010038","name":"Neutrogena Ultra Sheer Body SPF 30","segment":1,"shelf":1,"position":2,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680068790","name":"Neutrogena Ultra Sheer Sunblock SPF 55","segment":1,"shelf":1,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0008680010355","name":"Neutrogena Ultra Sheer Mineral Face Broad Spectrum Stick","segment":1,"shelf":1,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007050111281","name":"Neutrogena Ultra Sheer Lotion","segment":1,"shelf":1,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680068770","name":"Neutrogena Ultra Sheer Sunblock SPF 70","segment":1,"shelf":1,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0008680010040","name":"Neutrogena Ultra Sheer Sunblock SPF 70","segment":1,"shelf":1,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680010043","name":"Neutrogena Ultra Sheer Lotion SPF 100+","segment":1,"shelf":1,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680011080","name":"Neutrogena Sheer Zinc Sunscreen SPF 50","segment":1,"shelf":1,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0008680010274","name":"Neutrogena Mineral Ultra Sheer Dry-Touch Face Stick","segment":1,"shelf":1,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680086031","name":"Neutrogena Clear Face Lotion SPF 30","segment":1,"shelf":2,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680011282","name":"Neutrogena Clear Face Lotion SPF 50","segment":1,"shelf":2,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680007270","name":"Neutrogena Clear Face SPF 50 Sunscreen","segment":1,"shelf":2,"position":3,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680006650","name":"Neutrogena Clear Face Serum SPF 50","segment":1,"shelf":2,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680087025","name":"Neutrogena Sport Face Lotion SPF 70+","segment":1,"shelf":2,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680006797","name":"Neutrogena Sport Active Defense Sunscreen","segment":1,"shelf":2,"position":6,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007050111342","name":"Neutrogena Hydro Boost Water Gel Lotion SPF 50","segment":1,"shelf":2,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0086000078186","name":"Black Girl Sunscreen Glow SPF 50","segment":1,"shelf":2,"position":8,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0086012100040","name":"Black Girl Sunscreen Moisturize SPF 50","segment":1,"shelf":2,"position":9,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0086000078182","name":"Black Girl Sunscreen Hybrid SPF 50","segment":1,"shelf":2,"position":10,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0008680087273","name":"Neutrogena Beach Defense Spray SPF 30","segment":1,"shelf":3,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680011254","name":"Neutrogena Beach Defense Spray SPF 50","segment":1,"shelf":3,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680011253","name":"Neutrogena Beach Defense Water + Sun Sunscreen Lotion Body","segment":1,"shelf":3,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680087275","name":"Neutrogena Ultra Sheer SPF 50 Stick","segment":1,"shelf":3,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680087274","name":"Neutrogena Beach Defense Spray SPF 70","segment":1,"shelf":3,"position":5,"facings":1,"isNew":false,"isMove":false,"srp":""},
{"upc":"0008680007852","name":"Neutrogena Beach Defense SPF 70 Lotion","segment":1,"shelf":3,"position":6,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0008680087272","name":"Neutrogena Beach Defense Lotion SPF 70","segment":1,"shelf":3,"position":7,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003520","name":"Coppertone Complete Spray SPF 50","segment":1,"shelf":4,"position":1,"facings":2,"isNew":false,"isMove":false,"srp":""},
{"upc":"0007214003205","name":"Coppertone Complete Lotion SPF 50","segment":1,"shelf":4,"position":2,"facings":1,"isNew":false,"isMove":false,"srp":""},
{"upc":"0007214003925","name":"Coppertone Sport Sunscreen Spray","segment":1,"shelf":4,"position":3,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003912","name":"Coppertone Sport C-Spray SPF 50","segment":1,"shelf":4,"position":4,"facings":1,"isNew":false,"isMove":false,"srp":""},
{"upc":"0007214002747","name":"Coppertone Sport Sunscreen SPF 50","segment":1,"shelf":4,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214002748","name":"Coppertone Sport Sunscreen SPF 70","segment":1,"shelf":4,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003825","name":"Coppertone Kids Spray SPF 50","segment":1,"shelf":4,"position":7,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003926","name":"Coppertone Sunscreen Spray Twin Pack","segment":1,"shelf":5,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003927","name":"Coppertone Sport 4-in-1 Spray SPF 30","segment":1,"shelf":5,"position":2,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214002761","name":"Coppertone Sport 4-in-1 Lotion SPF 30","segment":1,"shelf":5,"position":3,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003826","name":"Coppertone Sport Face Sunscreen","segment":1,"shelf":5,"position":4,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214002765","name":"Coppertone Sport Spray SPF 70","segment":1,"shelf":5,"position":5,"facings":1,"isNew":false,"isMove":false,"srp":""},
{"upc":"0007214002770","name":"Coppertone Sport Spray SPF 100","segment":1,"shelf":5,"position":6,"facings":1,"isNew":false,"isMove":false,"srp":""},
{"upc":"0008680006407","name":"Neutrogena Purescreen+ Mineral Invisible Daily","segment":2,"shelf":1,"position":1,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680011153","name":"Neutrogena Daily Defense Serum SPF 60","segment":2,"shelf":1,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680006649","name":"Neutrogena Invisible Daily Spray","segment":2,"shelf":1,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680011151","name":"Neutrogena Invisible Daily SPF 60","segment":2,"shelf":1,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680010383","name":"Neutrogena Invisible Daily Defense Sunscreen","segment":2,"shelf":1,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0008680010357","name":"Neutrogena Sun Rescue After Sun Rehydrating Mist","segment":2,"shelf":1,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000047","name":"Sun Bum Cool Down Lotion","segment":2,"shelf":1,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548608754","name":"Hawaiian Tropic Lime Coolada After Sun","segment":2,"shelf":1,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548609166","name":"Hawaiian Tropic After Sun Body Butter","segment":2,"shelf":1,"position":9,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007965600008","name":"Banana Boat Aloe After Sun Lotion","segment":2,"shelf":1,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965600114","name":"Banana Boat Pure Aloe Vera Gel","segment":2,"shelf":1,"position":11,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007548608989","name":"Hawaiian Tropic Sport C-Spray SPF 30","segment":2,"shelf":2,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548609114","name":"Hawaiian Tropic Sport Spray SPF 50","segment":2,"shelf":2,"position":2,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548608747","name":"Hawaiian Tropic Sheer Touch Lotion SPF 30","segment":2,"shelf":2,"position":3,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548608760","name":"Hawaiian Tropic Sheer Touch SPF 50 Fluid","segment":2,"shelf":2,"position":4,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548613763","name":"Hawaiian Tropic Hydration Weightless Moisturizer","segment":2,"shelf":2,"position":5,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548609192","name":"Hawaiian Tropic Silk Hydration Weightless","segment":2,"shelf":2,"position":6,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007965614431","name":"Banana Boat Sheer Sensitive SPF 50 Spray","segment":2,"shelf":3,"position":1,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007965614432","name":"Banana Boat Sheer Sensitive SPF 50 Lotion","segment":2,"shelf":3,"position":2,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007965614433","name":"Banana Boat Sheer Sensitive Lotion SPF 50","segment":2,"shelf":3,"position":3,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007965602580","name":"Banana Boat Kids Sport C-Spray SPF 50","segment":2,"shelf":3,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965602560","name":"Banana Boat Kids Sport SPF 50 Twin Pack","segment":2,"shelf":3,"position":5,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965601806","name":"Banana Boat Kids Sport Ultra Mist SPF 50","segment":2,"shelf":3,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965614030","name":"Banana Boat Kids SPF 50 Advanced Control Mist","segment":2,"shelf":3,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965605082","name":"Banana Boat Kids Spray SPF 100","segment":2,"shelf":3,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604662","name":"Banana Boat Aloe Lip Balm SPF 45","segment":2,"shelf":3,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0007965603223","name":"Banana Boat Sport Clear Spray SPF 50","segment":2,"shelf":4,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965603179","name":"Banana Boat Ultra Mist Sport SPF 50","segment":2,"shelf":4,"position":2,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965601332","name":"Banana Boat Sport SPF 50 Spray Twin Pack","segment":2,"shelf":4,"position":3,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965614293","name":"Banana Boat Sport SPF 50 Sunscreen","segment":2,"shelf":4,"position":4,"facings":3,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965614029","name":"Banana Boat Sport SPF 50 Advanced Control Mist","segment":2,"shelf":4,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604972","name":"Banana Boat Sport Sun SPF 50","segment":2,"shelf":4,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965603178","name":"Banana Boat Sport Ultra Mist SPF 30","segment":2,"shelf":5,"position":1,"facings":2,"isNew":false,"isMove":false,"srp":""},
{"upc":"0007965603165","name":"Banana Boat Sport SPF 30 Spray Twin Pack","segment":2,"shelf":5,"position":2,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604971","name":"Banana Boat Sport Lotion SPF 30","segment":2,"shelf":5,"position":3,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965613089","name":"Banana Boat Sport Ultra SPF 60 Rub-On Lotion","segment":2,"shelf":5,"position":4,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965605080","name":"Banana Boat Sport Spray SPF 100","segment":2,"shelf":5,"position":5,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604968","name":"Banana Boat Sport Sunscreen SPF 100","segment":2,"shelf":5,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0036519750210","name":"Solarcaine After Sun Relief Spray","segment":3,"shelf":1,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200382","name":"Alba Kids Tropical Fruit Spray SPF 50","segment":3,"shelf":1,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474201023","name":"Alba Botanica Wild Wave Sunscreen Spray","segment":3,"shelf":1,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200390","name":"Alba Sport Island Lotion SPF 50","segment":3,"shelf":1,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200389","name":"Alba Fragrance Free Sheer Mineral Lotion SPF 30","segment":3,"shelf":1,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200404","name":"Alba Fragrance Free Sheer Mineral Spray SPF 30","segment":3,"shelf":1,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200381","name":"Alba Very Emollient Fragrance Free SPF 50","segment":3,"shelf":1,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081000937008","name":"Thinksport All Sheer Mineral Sunscreen Spray","segment":3,"shelf":1,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081000937215","name":"Thinksport Clear Zinc Face Sunscreen","segment":3,"shelf":1,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081000937804","name":"Thinksport Clear Zinc SPF 50","segment":3,"shelf":1,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081000937795","name":"Thinksport Kids Clear Zinc","segment":3,"shelf":1,"position":11,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081000937007","name":"Thinksport All Sheer Mineral Sunscreen Spray","segment":3,"shelf":1,"position":12,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474201239","name":"Alba Botanica Hawaiian Coconut Sunscreen","segment":3,"shelf":2,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474201078","name":"Alba Hawaiian Sunscreen Spray SPF 50","segment":3,"shelf":2,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200827","name":"Alba Hawaiian Vibe Lotion SPF 50","segment":3,"shelf":2,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200439","name":"Alba Fragrance Free Sun Spray","segment":3,"shelf":2,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474200400","name":"Alba Very Emollient Sport SPF 45","segment":3,"shelf":2,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0072474201052","name":"Alba SPF 50 Sheer Mineral Face Lotion","segment":3,"shelf":2,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0085987100489","name":"Thinksport Kids Sunscreen SPF 50","segment":3,"shelf":2,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0085987100490","name":"Thinkbaby Body & Face Sunscreen SPF 50","segment":3,"shelf":2,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0089039700268","name":"Thinkbaby Safe Sunscreen SPF 50","segment":3,"shelf":2,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081000937175","name":"Thinkbaby Clear Zinc SPF 30 Sunscreen","segment":3,"shelf":2,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081327701980","name":"Babyganics Mineral Sunscreen SPF 50","segment":3,"shelf":3,"position":1,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081003592138","name":"Babyganics Sheer Sunscreen Lotion SPF 50","segment":3,"shelf":3,"position":2,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081011561524","name":"Hello Bello Kids Sunscreen Spray SPF 50","segment":3,"shelf":3,"position":3,"facings":2,"isNew":false,"isMove":false,"srp":""},
{"upc":"0081011561523","name":"Hello Bello Kids SPF 50 Lotion","segment":3,"shelf":3,"position":4,"facings":2,"isNew":false,"isMove":false,"srp":""},
{"upc":"0081011561522","name":"Hello Bello Baby Mineral Sunscreen","segment":3,"shelf":3,"position":5,"facings":2,"isNew":false,"isMove":false,"srp":""},
{"upc":"0008680011082","name":"Neutrogena Baby Suncare SPF 50","segment":3,"shelf":3,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214002739","name":"Coppertone WaterBabies Lotion SPF 50","segment":3,"shelf":3,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0030316208005","name":"Blue Lizard Sport Sunscreen SPF 50+","segment":3,"shelf":4,"position":1,"facings":3,"isNew":true,"isMove":false,"srp":""},
{"upc":"0030316208105","name":"Blue Lizard Kids Sunscreen SPF 50+","segment":3,"shelf":4,"position":2,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0030316208305","name":"Blue Lizard SPF 50+ Sunscreen","segment":3,"shelf":4,"position":3,"facings":3,"isNew":false,"isMove":true,"srp":""},
{"upc":"0030316204630","name":"Blue Lizard Sensitive SPF 50+ Lotion","segment":3,"shelf":4,"position":4,"facings":2,"isNew":false,"isMove":true,"srp":""},
{"upc":"0030316201305","name":"Blue Lizard Sensitive SPF 50+ Stick","segment":3,"shelf":4,"position":5,"facings":2,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0507000316193","name":"Polar Bare Sunscreen Coconut Vanilla","segment":3,"shelf":5,"position":1,"facings":3,"isNew":true,"isMove":false,"srp":""},
{"upc":"0507000316198","name":"Polar Bare I Scream For Sunscreen Spray SPF 50","segment":3,"shelf":5,"position":2,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0507000316197","name":"Polar Bare I Scream For Sunscreen Spray SPF 30","segment":3,"shelf":5,"position":3,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0507000316192","name":"Polar Bare Mineral Hydrating Body Cream","segment":3,"shelf":5,"position":4,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0507000316190","name":"Polar Bare Sunscreen Coconut Vanilla SPF 50","segment":3,"shelf":5,"position":5,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0507000316191","name":"Polar Bare Sunscreen Coconut Vanilla SPF 30","segment":3,"shelf":5,"position":6,"facings":2,"isNew":true,"isMove":false,"srp":""},
{"upc":"0005440233079","name":"Australian Gold Bronze Spray","segment":4,"shelf":1,"position":1,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0005440233091","name":"Australian Gold Continuous Spray SPF 15","segment":4,"shelf":1,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710800286","name":"b.tan Love At First Tan","segment":4,"shelf":1,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710800873","name":"b.tan Tanned AF Self Tan Mousse","segment":4,"shelf":1,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710800100","name":"b.tan I Want The Darkest Tan Possible Self Tan Mousse","segment":4,"shelf":1,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604663","name":"Banana Boat Dry Oil Deep Tanning Ultra Mist SPF 4","segment":4,"shelf":1,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604450","name":"Banana Boat Dry Oil SPF 8","segment":4,"shelf":1,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965604647","name":"Banana Boat Dry Oil SPF 25","segment":4,"shelf":1,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965600780","name":"Banana Boat Sunless Lotion Light/Medium","segment":4,"shelf":1,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007965600781","name":"Banana Boat Sunless Lotion Deep/Dark","segment":4,"shelf":1,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710800213","name":"b.tan I Don't Want To Hear It Tan Mitt","segment":4,"shelf":1,"position":11,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007214003823","name":"Coppertone Tanning Lotion SPF 15","segment":4,"shelf":2,"position":1,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710800308","name":"b.tan Tanned AF Tan Oil Spray","segment":4,"shelf":2,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548608743","name":"Hawaiian Tropic Dark Tanning Oil","segment":4,"shelf":2,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0007548608872","name":"Hawaiian Tropic Golden Tanning Dry Oil SPF 15","segment":4,"shelf":2,"position":4,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0007548608855","name":"Hawaiian Tropic Dark Tanning Oil Spray SPF 6","segment":4,"shelf":2,"position":5,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0934710801686","name":"b.tan Glow Your Own Way Tan Gel","segment":4,"shelf":2,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710803136","name":"b.tan Glow Your Own Way Tan Gel Medium","segment":4,"shelf":2,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710804649","name":"b.tan Glow Your Own Way Tan Gel Dark","segment":4,"shelf":2,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0934710805107","name":"b.tan There You Glo Self Tan","segment":4,"shelf":2,"position":9,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0081002017596","name":"Bondi Sands Self Tan Foam Light/Medium","segment":4,"shelf":3,"position":1,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081002017595","name":"Bondi Sands Self Tan Foam Dark","segment":4,"shelf":3,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081002017599","name":"Bondi Sands Self Tanning Foam","segment":4,"shelf":3,"position":3,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0070906900006","name":"Maui Babe Browning Lotion","segment":4,"shelf":3,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0506048979399","name":"Tanologist Daily Glow Drops Light","segment":4,"shelf":3,"position":5,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0506048979400","name":"Tanologist Daily Glow Drops Medium","segment":4,"shelf":3,"position":6,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0506048979383","name":"Tanologist Daily Glow Drops Dark","segment":4,"shelf":3,"position":7,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0506048979384","name":"Tanologist Daily Glow Serum","segment":4,"shelf":3,"position":8,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0506048979388","name":"Tanologist Tinted Mousse Medium","segment":4,"shelf":3,"position":9,"facings":1,"isNew":true,"isMove":false,"srp":""},
{"upc":"0081015096024","name":"Dear Cloudy Tone Blur Sunscreen","segment":4,"shelf":3,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081015096172","name":"Dear Cloudy Body Glaze Essence Sunscreen","segment":4,"shelf":3,"position":11,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0084015560316","name":"Sun Bum Kids Sunscreen Spray SPF 50","segment":4,"shelf":4,"position":1,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0084015560315","name":"Sun Bum Kids Vegan Sunscreen SPF 50","segment":4,"shelf":4,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0084015560314","name":"Sun Bum Kids Face Stick Sunscreen SPF 50","segment":4,"shelf":4,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000279","name":"Baby Bum SPF 50 Mineral Sunscreen Stick","segment":4,"shelf":4,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":"SRP"},
{"upc":"0087176000278","name":"Baby Bum SPF 50 Mineral Sunscreen Lotion","segment":4,"shelf":4,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081015096142","name":"Dear Cloudy Hydra Gel Sun Patches","segment":4,"shelf":4,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081015096026","name":"Dear Cloudy Sunny Defense SPF Stick","segment":4,"shelf":4,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081015096176","name":"Dear Cloudy Tone Perfect SPF Cushion","segment":4,"shelf":4,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0081015096028","name":"Dear Cloudy Luminous Aqua Sun Mist","segment":4,"shelf":4,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000474","name":"Sun Bum Mineral SPF 30","segment":4,"shelf":5,"position":1,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000196","name":"Sun Bum SPF 30 Spray 6oz","segment":4,"shelf":5,"position":2,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000044","name":"Sun Bum SPF 30 Lotion 6oz","segment":4,"shelf":5,"position":3,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000309","name":"Sun Bum Original SPF 30 Sunscreen Stick","segment":4,"shelf":5,"position":4,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000753","name":"Sun Bum SPF 30 Scalp & Hair Mist Spray","segment":4,"shelf":5,"position":5,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000197","name":"Sun Bum SPF 50 Spray 6oz","segment":4,"shelf":5,"position":6,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000045","name":"Sun Bum Original SPF 50 Lotion","segment":4,"shelf":5,"position":7,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000208","name":"Sun Bum Original Spray SPF 70","segment":4,"shelf":5,"position":8,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000046","name":"Sun Bum Original SPF 70 Sunscreen","segment":4,"shelf":5,"position":9,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0084015560061","name":"Sun Bum SPF 45 Face Mist","segment":4,"shelf":5,"position":10,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000297","name":"Sun Bum Original Face SPF 50","segment":4,"shelf":5,"position":11,"facings":1,"isNew":false,"isMove":true,"srp":""},
{"upc":"0087176000183","name":"Sun Bum Tanning Oil SPF 15","segment":4,"shelf":5,"position":12,"facings":1,"isNew":false,"isMove":true,"srp":""}
],
    upcRedirects: {
      "0007214003517": "0007214003912",
      "0081008487202": "0081011561524",
      "0081008487122": "0081011561523",
      "0081008487384": "0081011561522"
    }
  },
  "endcap": {
    id: "endcap",
    name: "4ft Endcap",
    subtitle: "FRED MEYER SUNCARE 6 SHELF ENDCAP SEASONAL",
    pogNumber: "185-SUNTAN 150",
    liveDate: "02-08-26",
    sides: 1,
    shelves: 6,
    pdfFile: "endcap-8552744.pdf",
    products: [{"upc":"0934710800213","name":"BTAN IDWTOMH TAN MITT","segment":1,"shelf":6,"position":1,"facings":1,"isNew":true,"srp":""},{"upc":"0934710804649","name":"BTAN GLW YR OWN WY TN GEL","segment":1,"shelf":6,"position":2,"facings":1,"isNew":true,"srp":""},{"upc":"0934710801686","name":"B.TAN GLOW YOUR OWN GEL","segment":1,"shelf":6,"position":3,"facings":1,"isNew":true,"srp":""},{"upc":"0934710800286","name":"LOVE AT FIRST TAN","segment":1,"shelf":6,"position":4,"facings":1,"isNew":true,"srp":""},{"upc":"0934710800873","name":"BTAN TNND AF SLF TN MOUSS","segment":1,"shelf":6,"position":5,"facings":1,"isNew":true,"srp":""},{"upc":"0081002017596","name":"BNDSNS SELF TAN FOAM L/M","segment":1,"shelf":6,"position":6,"facings":1,"isNew":true,"srp":""},{"upc":"0081002017595","name":"BNDSNS SELF TAN FOAM DRK","segment":1,"shelf":6,"position":7,"facings":1,"isNew":true,"srp":""},{"upc":"0005440233091","name":"AUST GLD CNT SPRY SPF 15","segment":1,"shelf":6,"position":8,"facings":1,"isNew":true,"srp":""},{"upc":"0005440233079","name":"AUST GLD BRNZ SPRY","segment":1,"shelf":6,"position":9,"facings":1,"isNew":true,"srp":""},{"upc":"0007548608743","name":"HWTRP DARK TANNING OIL","segment":1,"shelf":6,"position":10,"facings":1,"isNew":true,"srp":""},{"upc":"0007965604663","name":"BBOAT DRY OIL DP UM SPF4","segment":1,"shelf":6,"position":11,"facings":1,"isNew":true,"srp":""},{"upc":"0007965604647","name":"BBOAT DRY OIL SPF25","segment":1,"shelf":6,"position":12,"facings":1,"isNew":true,"srp":""},{"upc":"0007965600781","name":"BB SLESS LTN DP/DK","segment":1,"shelf":6,"position":13,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003823","name":"CPRTN TANNING LTN SPF15","segment":1,"shelf":6,"position":14,"facings":1,"isNew":true,"srp":""},{"upc":"0070906900006","name":"MBABE BROWNING LOTION","segment":1,"shelf":6,"position":15,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000183","name":"SUN BUM TNNG OIL SPF 15","segment":1,"shelf":6,"position":16,"facings":1,"isNew":true,"srp":""},{"upc":"0506048979399","name":"TANOLOGIST DAILY GL","segment":1,"shelf":6,"position":17,"facings":1,"isNew":true,"srp":""},{"upc":"0506048979383","name":"TANOLOGIST DAILY GL","segment":1,"shelf":6,"position":18,"facings":1,"isNew":true,"srp":""},{"upc":"0506048979388","name":"TINTED MOUSSE MEDIUM 200ML","segment":1,"shelf":6,"position":19,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000196","name":"SUN BUM SPF 30 SPRAY 6 OZ","segment":1,"shelf":5,"position":1,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000044","name":"SUN BUM SPF 30 LOTION 6 O","segment":1,"shelf":5,"position":2,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000309","name":"SUN BUM ORIGINAL SPF 30 S","segment":1,"shelf":5,"position":3,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000197","name":"SUN BUM SPF 50 SPRAY 6 OZ","segment":1,"shelf":5,"position":4,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000045","name":"SUN BUM ORIGINAL SPF 50 L","segment":1,"shelf":5,"position":5,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000208","name":"SUN BUM ORIG SPRAY SPF70","segment":1,"shelf":5,"position":6,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000046","name":"SUN BUM ORIG SPF70 SNSCRN","segment":1,"shelf":5,"position":7,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000297","name":"SUN BUM ORIGINAL FACE 50","segment":1,"shelf":5,"position":8,"facings":1,"isNew":true,"srp":""},{"upc":"0084015560061","name":"SUNBUM SPF 45 FACE MIST","segment":1,"shelf":5,"position":9,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000753","name":"SUN BUM SPF 30 SCALP SPRA","segment":1,"shelf":5,"position":10,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000474","name":"SUN BUM MNRL SPF 30","segment":1,"shelf":5,"position":11,"facings":1,"isNew":true,"srp":""},{"upc":"0507000316197","name":"PLBR I SCR FOR SUNSC SPRY","segment":1,"shelf":5,"position":12,"facings":1,"isNew":true,"srp":""},{"upc":"0507000316191","name":"PLBR SNSCRN CCNT VNLA","segment":1,"shelf":5,"position":13,"facings":1,"isNew":true,"srp":""},{"upc":"0507000316198","name":"PLBR I SCR FOR SUNSC SPRY","segment":1,"shelf":5,"position":14,"facings":1,"isNew":true,"srp":""},{"upc":"0507000316190","name":"PLBR SNSCRN CCNT VNLA","segment":1,"shelf":5,"position":15,"facings":1,"isNew":true,"srp":""},{"upc":"0507000316192","name":"PLBR MNRL HYD BDY CRM","segment":1,"shelf":5,"position":16,"facings":1,"isNew":true,"srp":""},{"upc":"0030316208105","name":"BLUE LIZARD KIDS SP","segment":1,"shelf":5,"position":17,"facings":1,"isNew":true,"srp":""},{"upc":"0030316208005","name":"BLUE LIZARD SPORT S","segment":1,"shelf":5,"position":18,"facings":1,"isNew":true,"srp":""},{"upc":"0030316208305","name":"BLU LZD SPF 50 SNSCRN","segment":1,"shelf":5,"position":19,"facings":1,"isNew":true,"srp":""},{"upc":"0030316204630","name":"BL SENSITIVE SPF 50 LOTIO","segment":1,"shelf":5,"position":20,"facings":1,"isNew":true,"srp":""},{"upc":"0030316201305","name":"BL SENSITIVE SPF 50 STICK","segment":1,"shelf":5,"position":21,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003826","name":"CPRTN SPORT FACE SUNCRN","segment":1,"shelf":4,"position":1,"facings":1,"isNew":true,"srp":""},{"upc":"0007214002765","name":"CPRTN SPRT SPRY SPF 7","segment":1,"shelf":4,"position":2,"facings":1,"isNew":true,"srp":""},{"upc":"0007214002748","name":"CPRTN SPRT SUNSCRN SPF70","segment":1,"shelf":4,"position":3,"facings":1,"isNew":true,"srp":""},{"upc":"0007214002770","name":"CPRTN SPRT SPRAY SPF100","segment":1,"shelf":4,"position":4,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003520","name":"CPRTN CMPLT SPR SPF50","segment":1,"shelf":4,"position":5,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003205","name":"CPRTN CMPLT LTN SPF50","segment":1,"shelf":4,"position":6,"facings":1,"isNew":true,"srp":""},{"upc":"0007965603223","name":"BBOAT SPRT CLR SPRY SPF50","segment":1,"shelf":4,"position":7,"facings":1,"isNew":true,"srp":""},{"upc":"0007965601332","name":"BB SPRT SPF50 SPRY TWN PK","segment":1,"shelf":4,"position":8,"facings":1,"isNew":true,"srp":""},{"upc":"0007965603179","name":"BBOAT ULTMST SPORT SPF50","segment":1,"shelf":4,"position":9,"facings":1,"isNew":true,"srp":""},{"upc":"0007965604972","name":"BBOAT SPRT SUN SPF50","segment":1,"shelf":4,"position":10,"facings":1,"isNew":true,"srp":""},{"upc":"0007965614029","name":"BBOAT SPRT SPF AD CNT MST","segment":1,"shelf":4,"position":11,"facings":1,"isNew":true,"srp":""},{"upc":"0007965614293","name":"BBOAT SPORT SPF50 SNSCRN","segment":1,"shelf":4,"position":12,"facings":1,"isNew":true,"srp":""},{"upc":"0007965605080","name":"BBOAT SPRT SPRAY SPF100","segment":1,"shelf":4,"position":13,"facings":1,"isNew":true,"srp":""},{"upc":"0007965604968","name":"BBOAT SPRT SUN SPF100","segment":1,"shelf":4,"position":14,"facings":1,"isNew":true,"srp":""},{"upc":"0008680010038","name":"NEUTR ULT SHR BODY SPF30","segment":1,"shelf":4,"position":15,"facings":1,"isNew":true,"srp":""},{"upc":"0008680068785","name":"NEUTR ULT SHR SNBLK SPF30","segment":1,"shelf":4,"position":16,"facings":1,"isNew":true,"srp":""},{"upc":"0008680068790","name":"NEUTR ULT SHR SNBLK SPF55","segment":1,"shelf":4,"position":17,"facings":1,"isNew":true,"srp":""},{"upc":"0008680010040","name":"NEUTR ULT SHR SNBLK SPF70","segment":1,"shelf":4,"position":18,"facings":1,"isNew":true,"srp":""},{"upc":"0008680068770","name":"NEUTR ULT SHR SNBLK SPF70","segment":1,"shelf":4,"position":19,"facings":1,"isNew":true,"srp":""},{"upc":"0008680010274","name":"NEUTR MRL ULT SR DT FBSTK","segment":1,"shelf":4,"position":20,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003926","name":"CPRTN SNSCRN SPRY TWN PK","segment":1,"shelf":3,"position":1,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003927","name":"CPRTN SPRT 4N1 SPRY SPF30","segment":1,"shelf":3,"position":2,"facings":1,"isNew":true,"srp":""},{"upc":"0007214002761","name":"CPRTN SPRT 4N1 LTN SPF30","segment":1,"shelf":3,"position":3,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003925","name":"CPRTN SPRT SUNSCN SPRAY","segment":1,"shelf":3,"position":4,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003912","name":"CPRTN SPORT C SPRAY SPF50","segment":1,"shelf":3,"position":5,"facings":1,"isNew":false,"srp":""},{"upc":"0007214002747","name":"CPRTN SPRT SNSCRN SPF50","segment":1,"shelf":3,"position":6,"facings":1,"isNew":true,"srp":""},{"upc":"0007965603165","name":"BB SPRT SPF30 SPRY TWN PK","segment":1,"shelf":3,"position":7,"facings":1,"isNew":true,"srp":""},{"upc":"0007965603178","name":"BBOAT SPRT ULTMST SPF30","segment":1,"shelf":3,"position":8,"facings":1,"isNew":true,"srp":""},{"upc":"0007965604971","name":"BBOAT SPRT LOTION SPF30","segment":1,"shelf":3,"position":9,"facings":1,"isNew":true,"srp":""},{"upc":"0007965613089","name":"BBOAT SPR ULT SPF60 RN LT","segment":1,"shelf":3,"position":10,"facings":1,"isNew":true,"srp":""},{"upc":"0008680087273","name":"NEUTR BCH DFNS SPRY SPF30","segment":1,"shelf":3,"position":11,"facings":1,"isNew":true,"srp":""},{"upc":"0008680011254","name":"NEUTR BCH DFES SPRAY","segment":1,"shelf":3,"position":12,"facings":1,"isNew":true,"srp":""},{"upc":"0008680011253","name":"NTG BCH DFWTRSNPRTCSNLTNB","segment":1,"shelf":3,"position":13,"facings":1,"isNew":true,"srp":""},{"upc":"0008680087275","name":"NEUTR ULT SHR SPF50 STICK","segment":1,"shelf":3,"position":14,"facings":1,"isNew":true,"srp":""},{"upc":"0008680087274","name":"NEUTR BCH DFNS SPRY SPF70","segment":1,"shelf":3,"position":15,"facings":1,"isNew":true,"srp":""},{"upc":"0008680007852","name":"NEUTR BCH DEFNS SPF70 LTN","segment":1,"shelf":3,"position":16,"facings":1,"isNew":true,"srp":""},{"upc":"0008680087272","name":"NEUTR BCH DFNS LTN SPF70","segment":1,"shelf":3,"position":17,"facings":1,"isNew":true,"srp":""},{"upc":"0007548608989","name":"HWTRP SPRT CSPRAY SPF30","segment":1,"shelf":2,"position":1,"facings":1,"isNew":true,"srp":""},{"upc":"0007548609114","name":"HWTRP SPT SPRAY SPF50","segment":1,"shelf":2,"position":2,"facings":1,"isNew":true,"srp":""},{"upc":"0007548609192","name":"HWTRP SLKHYD WGHTLSS","segment":1,"shelf":2,"position":3,"facings":1,"isNew":true,"srp":""},{"upc":"0007548613763","name":"HWTRP HYDRATION WTLS MSTR","segment":1,"shelf":2,"position":4,"facings":1,"isNew":true,"srp":""},{"upc":"0007548608747","name":"HWTRP SHEER LTN SPF30","segment":1,"shelf":2,"position":5,"facings":1,"isNew":true,"srp":""},{"upc":"0007548608760","name":"HWTRP SHEER SUN SPF50 FL","segment":1,"shelf":2,"position":6,"facings":1,"isNew":true,"srp":""},{"upc":"0007965614431","name":"BBOAT SHR SENS SPF50 SPR","segment":1,"shelf":2,"position":7,"facings":1,"isNew":true,"srp":""},{"upc":"0007965614432","name":"BBOAT SHR SENS SPF50 LTN","segment":1,"shelf":2,"position":8,"facings":1,"isNew":true,"srp":""},{"upc":"0007965614433","name":"BBOAT SHR SENS LTN SPF50","segment":1,"shelf":2,"position":9,"facings":1,"isNew":true,"srp":""},{"upc":"0084015560316","name":"SUNBUM KIDS SUNSCRN SPRAY","segment":1,"shelf":2,"position":10,"facings":1,"isNew":true,"srp":""},{"upc":"0084015560315","name":"SUNBUM KIDS VGN SUNSCREEN","segment":1,"shelf":2,"position":11,"facings":1,"isNew":true,"srp":""},{"upc":"0084015560314","name":"SUNBUM KIDS FCSTCK SNSCRN","segment":1,"shelf":2,"position":12,"facings":1,"isNew":true,"srp":""},{"upc":"0081011561524","name":"HELO BELO KIDS SNSCR SPR","segment":1,"shelf":2,"position":13,"facings":1,"isNew":false,"srp":""},{"upc":"0081011561523","name":"HELLO BELLO KIDS SPF50 LO","segment":1,"shelf":2,"position":14,"facings":1,"isNew":false,"srp":""},{"upc":"0008680006797","name":"NEUTR SPRT ACT DF SUNSCRN","segment":1,"shelf":2,"position":15,"facings":1,"isNew":true,"srp":""},{"upc":"0008680087025","name":"NEUTR SPRT FACE LTN SPF70","segment":1,"shelf":2,"position":16,"facings":1,"isNew":true,"srp":""},{"upc":"0008680086031","name":"NEUTR CLR FACE LTN SPF30","segment":1,"shelf":2,"position":17,"facings":1,"isNew":true,"srp":""},{"upc":"0008680007270","name":"NEUTR CLR FC SPF50 SNSCRN","segment":1,"shelf":2,"position":18,"facings":1,"isNew":true,"srp":""},{"upc":"0008680011282","name":"NEUTR CLR FACE LOTION","segment":1,"shelf":2,"position":19,"facings":1,"isNew":true,"srp":""},{"upc":"0008680006650","name":"NEUTR CLEAR FACE SERUM","segment":1,"shelf":2,"position":20,"facings":1,"isNew":true,"srp":""},{"upc":"0008680011080","name":"NEUTR SHR ZNC SNSCR SPF50","segment":1,"shelf":2,"position":21,"facings":1,"isNew":true,"srp":""},{"upc":"0007214003825","name":"COPPERTONE KIDS SPRAY SPF","segment":1,"shelf":1,"position":1,"facings":2,"isNew":true,"srp":""},{"upc":"0007965602560","name":"BB KIDS SPRT SPF50 TWN PK","segment":1,"shelf":1,"position":2,"facings":1,"isNew":true,"srp":""},{"upc":"0007965602580","name":"BB KIDS SPORT CSPRAY SPF","segment":1,"shelf":1,"position":3,"facings":1,"isNew":true,"srp":""},{"upc":"0007965601806","name":"BB KIDS SPRT UM SPF50","segment":1,"shelf":1,"position":4,"facings":1,"isNew":true,"srp":""},{"upc":"0007965614030","name":"BBOAT KIDS SPF AD CNT MST","segment":1,"shelf":1,"position":5,"facings":1,"isNew":true,"srp":""},{"upc":"0007965604662","name":"BB ALOE LIP BALM SPF45","segment":1,"shelf":1,"position":6,"facings":1,"isNew":true,"srp":""},{"upc":"0007214002739","name":"CPRTN WTRBABY LTN SPF50","segment":1,"shelf":1,"position":7,"facings":1,"isNew":true,"srp":""},{"upc":"0008680011082","name":"NEUTR BABY SUNCARE SPF 50","segment":1,"shelf":1,"position":8,"facings":1,"isNew":true,"srp":""},{"upc":"0081003592138","name":"BABYG SHR SNSCRN LTN SP50","segment":1,"shelf":1,"position":9,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000278","name":"BABY BUM SPF 50 MIN SUNSR","segment":1,"shelf":1,"position":10,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000279","name":"BABY BUM SPF 50 MIN SUNSR","segment":1,"shelf":1,"position":11,"facings":1,"isNew":true,"srp":""},{"upc":"0087176000047","name":"SUN BUM COOL DOWN LOTION","segment":1,"shelf":1,"position":12,"facings":1,"isNew":true,"srp":""},{"upc":"0507000316193","name":"PLBR SNSCRN CCNT VNLA","segment":1,"shelf":1,"position":13,"facings":1,"isNew":true,"srp":""},{"upc":"0036519750210","name":"SLRCN AFTR SUN RLF SPRAY","segment":1,"shelf":1,"position":14,"facings":1,"isNew":true,"srp":""},{"upc":"0007965600008","name":"BBOAT ALOE AFTRSN LTN","segment":1,"shelf":1,"position":15,"facings":1,"isNew":true,"srp":""},{"upc":"0007965600114","name":"BBOAT PURE ALOE VERA GEL","segment":1,"shelf":1,"position":16,"facings":1,"isNew":true,"srp":""},{"upc":"0007548608754","name":"HWTRP LIME COOLDA AFTRSN","segment":1,"shelf":1,"position":17,"facings":1,"isNew":true,"srp":""}],
    upcRedirects: {
      "0007214003517": "0007214003912",
      "0081008487202": "0081011561524",
      "0081008487122": "0081011561523"
    }
  }
};

let activePlanogram = null;
let PRODUCTS = [];

// UPC index ‚Äî rebuilt when planogram is selected
let upcIndex = {};
function buildUpcIndex() {
  upcIndex = {};
  PRODUCTS.forEach(p => {
    upcIndex[p.upc] = p;
    upcIndex[p.upc.replace(/^0+/,'')] = p;
    if (p.upc.length === 13) {
      upcIndex[p.upc.substring(1)] = p;
      upcIndex[p.upc.substring(1).replace(/^0+/,'')] = p;
    }
  });
}
// State
let currentMode = 'browse';
let currentSegment = 1;
let currentFilter = 'all';
let scanner = null;
let scannerRunning = false;

function setMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-tab').forEach(t => t.classList.toggle('active', t.dataset.mode === mode));
  document.getElementById('search-bar').style.display = mode === 'manual' ? 'block' : 'none';
  document.getElementById('scanner-section').classList.toggle('visible', mode === 'scan');
  document.getElementById('browse-section').style.display = mode === 'browse' ? 'block' : 'none';
  hideSearchResults();
  if (mode === 'manual') {
    setTimeout(() => document.getElementById('upc-input').focus(), 100);
  }
  if (mode !== 'scan' && scannerRunning) {
    stopScanner();
  }
}

function setSegment(seg, fromSwipe) {
  const maxSeg = activePlanogram ? activePlanogram.sides : 4;
  if (seg < 1 || seg > maxSeg) return;
  if (seg === currentSegment) return;
  currentSegment = seg;
  document.querySelectorAll('.nav-side-btn').forEach(t => t.classList.toggle('active', parseInt(t.dataset.seg) === seg));
  renderBrowse();
  window.scrollTo({top: 0});

  // Haptic feedback
  if (navigator.vibrate) navigator.vibrate(30);

  // Toast
  showBayToast(seg);
}

function showBayToast(seg) {
  const toast = document.getElementById('bay-toast');
  const colors = {1:'var(--seg1)',2:'var(--seg2)',3:'var(--seg3)',4:'var(--seg4)'};
  toast.style.borderColor = colors[seg];
  toast.style.color = colors[seg];
  toast.textContent = 'Side ' + seg;
  toast.classList.add('visible');
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => toast.classList.remove('visible'), 900);
}

// Swipe handling
(function() {
  let startX = 0, startY = 0, tracking = false, swiped = false;
  const THRESHOLD = 80;
  const VERTICAL_LOCK = 30;
  const edge = document.getElementById('swipe-edge');

  document.addEventListener('touchstart', function(e) {
    if (!activePlanogram || activePlanogram.sides <= 1) return;
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
    tracking = true;
    swiped = false;
  }, {passive: true});

  document.addEventListener('touchmove', function(e) {
    if (!activePlanogram || activePlanogram.sides <= 1) return;
    if (!tracking || swiped) return;
    const dx = e.touches[0].clientX - startX;
    const dy = e.touches[0].clientY - startY;
    const maxSeg = activePlanogram.sides;

    // If vertical scrolling, stop tracking
    if (Math.abs(dy) > VERTICAL_LOCK && Math.abs(dy) > Math.abs(dx)) {
      tracking = false;
      edge.classList.remove('visible');
      return;
    }

    // Show edge resistance at boundaries
    if (dx > 30 && currentSegment === 1) {
      edge.className = 'swipe-edge-indicator left visible';
    } else if (dx < -30 && currentSegment === maxSeg) {
      edge.className = 'swipe-edge-indicator right visible';
    } else {
      edge.classList.remove('visible');
    }

    // Trigger swipe at threshold
    if (dx > THRESHOLD && currentSegment > 1) {
      swiped = true;
      edge.classList.remove('visible');
      setSegment(currentSegment - 1, true);
    } else if (dx < -THRESHOLD && currentSegment < maxSeg) {
      swiped = true;
      edge.classList.remove('visible');
      setSegment(currentSegment + 1, true);
    }
  }, {passive: true});

  document.addEventListener('touchend', function() {
    tracking = false;
    swiped = false;
    edge.classList.remove('visible');
  }, {passive: true});
})();

function setFilter(f) {
  currentFilter = f;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.toggle('active', c.dataset.filter === f));
  renderBrowse();
}

function renderBrowse() {
  const container = document.getElementById('shelf-container');
  let products = PRODUCTS.filter(p => p.segment === currentSegment);
  if (currentFilter === 'new') products = products.filter(p => p.isNew);
  else if (currentFilter === 'srp') products = products.filter(p => p.srp === 'SRP');

  const shelves = {};
  products.forEach(p => {
    if (!shelves[p.shelf]) shelves[p.shelf] = [];
    shelves[p.shelf].push(p);
  });

  // Find max total facings across all shelves ‚Äî this is the grid column count
  let maxFacings = 0;
  const shelfCount = activePlanogram ? activePlanogram.shelves : 5;
  for (let s = 1; s <= shelfCount; s++) {
    const items = shelves[s] || [];
    const total = items.reduce((sum, p) => sum + (p.facings || 1), 0);
    if (total > maxFacings) maxFacings = total;
  }
  // Use a high LCM-friendly grid: multiply maxFacings by a scale factor
  // so we can distribute leftover columns evenly across items
  const gridCols = maxFacings * 12; // 12x gives us fine-grained distribution

  let html = '';
  for (let s = shelfCount; s >= 1; s--) {
    const items = (shelves[s] || []).sort((a,b) => a.position - b.position);
    if (items.length === 0 && currentFilter !== 'all') continue;
    const shelfLabel = s === shelfCount ? ' ¬∑ TOP' : s === 1 ? ' ¬∑ BOTTOM' : '';
    const totalFacings = items.reduce((sum, p) => sum + (p.facings || 1), 0);

    // Distribute gridCols among items proportional to their facings
    // Each item gets (facings / totalFacings) * gridCols columns, rounded
    let assignedCols = items.map(p => {
      return { p, raw: ((p.facings || 1) / totalFacings) * gridCols };
    });
    // Round and fix any remainder
    let spans = assignedCols.map(a => Math.round(a.raw));
    let diff = gridCols - spans.reduce((s,v) => s+v, 0);
    // Distribute remainder to largest items first
    while (diff !== 0) {
      let idx = diff > 0 ? spans.indexOf(Math.min(...spans)) : spans.indexOf(Math.max(...spans));
      spans[idx] += diff > 0 ? 1 : -1;
      diff += diff > 0 ? -1 : 1;
    }

    html += `<div class="shelf-section">
      <div class="shelf-header">
        <span class="shelf-num">S${s}</span>
        Shelf ${s}${shelfLabel} ¬∑ ${items.length} items ¬∑ ${totalFacings} facings
      </div>
      <div class="product-grid" style="grid-template-columns:repeat(${gridCols},1fr)">`;
    items.forEach((p, i) => {
      const badges = [];
      if (p.isNew) badges.push('<span class="mini-badge new-b">NEW</span>');
      if (p.srp === 'SRP') badges.push('<span class="mini-badge srp-b">SRP</span>');
      const facingCount = p.facings || 1;
      
      html += `<div class="facing-group-wrap" style="grid-column:span ${spans[i]}">`;
      html += `<div class="facing-group" onclick="showProduct('${p.upc}')">`;
      html += '<div class="facing-images">';
      for (let f = 0; f < facingCount; f++) {
        html += `<div class="facing-img-slot" id="img-${p.upc}-${f}"><div class="img-loading"></div></div>`;
      }
      html += '</div>';
      html += `<div class="facing-info">
        <div class="card-name">${p.name}</div>
        <div class="card-meta">
          <span class="card-pos">P${p.position} ¬∑ ${p.facings}F</span>
          <span class="card-upc">${p.upc.replace(/^0+/,'')}</span>
        </div>
      </div>`;
      html += '</div>';
      if (badges.length) {
        html += '<div class="facing-badge-row">'+badges.join('')+'</div>';
      }
      html += '</div>';
    });
    html += '</div></div>';
  }
  container.innerHTML = html;

  // Load images
  products.forEach(p => {
    for (let f = 0; f < (p.facings || 1); f++) {
      loadCardImage(p.upc, p.name, f);
    }
  });
}

function loadCardImage(upc, name, facingIdx) {
  const elId = 'img-' + upc + '-' + facingIdx;
  const el = document.getElementById(elId);
  if (!el) return;
  const padded = upc.padStart(13, '0');
  const img = new Image();
  img.alt = name;
  img.src = padded + '.webp';
  img.onload = function() {
    el.innerHTML = '';
    el.appendChild(img);
  };
  img.onerror = function() {
    el.innerHTML = '<div class="placeholder-icon">\u2600\ufe0f</div>';
  };
}
function findProduct(upc) {
  const cleaned = upc.replace(/[^0-9]/g,'');
  return upcIndex[cleaned] || upcIndex[cleaned.replace(/^0+/,'')] || null;
}

function showProduct(upc, redirectedFrom) {
  let p = findProduct(upc);

  // UPC Redirect check
  if (!p && !redirectedFrom && activePlanogram && activePlanogram.upcRedirects) {
    const cleaned = upc.replace(/[^0-9]/g,'');
    const padded = cleaned.padStart(13, '0');
    const newUpc = activePlanogram.upcRedirects[padded] || activePlanogram.upcRedirects[cleaned];
    if (newUpc) {
      showProduct(newUpc, padded);
      return;
    }
  }

  if (!p) {
    showNotFound(upc);
    return;
  }

  const segColors = {1:'seg1',2:'seg2',3:'seg3',4:'seg4'};
  const badges = [];
  if (p.isNew) badges.push('<span class="badge badge-new">New Item</span>');
  if (p.srp === 'SRP') badges.push('<span class="badge badge-srp">SRP</span>');

  // Redirect banner
  let redirectHtml = '';
  if (redirectedFrom) {
    redirectHtml = `<div class="redirect-banner">‚ö†Ô∏è UPC Changed<br>Old: ${redirectedFrom.replace(/^0+/,'')} ‚Üí New: ${p.upc.replace(/^0+/,'')}<br>Located at Side ${p.segment}, Shelf ${p.shelf}, Pos ${p.position}</div>`;
  }

  // Build mini planogram
  const shelfCount = activePlanogram ? activePlanogram.shelves : 5;
  const segProducts = PRODUCTS.filter(pr => pr.segment === p.segment);
  let pogHtml = '';
  for (let sh = shelfCount; sh >= 1; sh--) {
    const shelfItems = segProducts.filter(pr => pr.shelf === sh).sort((a,b) => a.position - b.position);
    if (shelfItems.length === 0) continue;
    const totalFacings = shelfItems.reduce((sum, it) => sum + it.facings, 0);
    pogHtml += `<div class="mini-shelf"><div class="mini-shelf-label">${sh}</div>`;
    shelfItems.forEach(it => {
      const w = Math.max((it.facings / totalFacings) * 100, 5);
      const hl = it.upc === p.upc ? ' highlighted' : '';
      pogHtml += `<div class="mini-slot${hl}" style="flex:${it.facings}" title="${it.name}"></div>`;
    });
    pogHtml += '</div>';
  }

  const card = document.getElementById('result-card');
  card.innerHTML = `
    <div class="result-image-wrap" id="result-img-wrap">
      <div class="img-loading"></div>
    </div>
    <div class="result-body">
      ${redirectHtml}
      <div class="result-name">${p.name}</div>
      <div class="result-upc">UPC: ${p.upc.replace(/^0+/,'')}</div>
      ${badges.length ? '<div class="result-badges">'+badges.join('')+'</div>' : ''}
      <div class="location-grid">
        <div class="loc-item">
          <div class="loc-label">Side</div>
          <div class="loc-value ${segColors[p.segment]}">${p.segment}</div>
        </div>
        <div class="loc-item">
          <div class="loc-label">Shelf</div>
          <div class="loc-value">${p.shelf}</div>
        </div>
        <div class="loc-item">
          <div class="loc-label">Position</div>
          <div class="loc-value">${p.position}</div>
        </div>
        <div class="loc-item">
          <div class="loc-label">Facings</div>
          <div class="loc-value">${p.facings}</div>
        </div>
      </div>
      <div class="mini-pog">
        <div class="mini-pog-title">Side ${p.segment} ‚Äî Shelf Layout</div>
        ${pogHtml}
      </div>
    </div>`;

  // Load result image
  const imgWrap = document.getElementById('result-img-wrap');
  const paddedUpc = p.upc.padStart(13, '0');
  const resultImg = new Image();
  resultImg.alt = p.name;
  resultImg.src = paddedUpc + '.webp';
  resultImg.onload = function() {
    imgWrap.innerHTML = '';
    imgWrap.appendChild(resultImg);
  };
  resultImg.onerror = function() {
    imgWrap.innerHTML = '<div class="result-placeholder"><div class="icon">\u2600\ufe0f</div>' + p.name + '</div>';
  };

  document.getElementById('result-overlay').classList.add('visible');
}

function showNotFound(upc) {
  const card = document.getElementById('result-card');
  card.innerHTML = `<div class="not-found">
    <div class="nf-icon">üîç</div>
    <div class="nf-text">Product not found on this planogram</div>
    <div class="nf-upc">${upc}</div>
  </div>`;
  document.getElementById('result-overlay').classList.add('visible');
}

function closeResult() {
  document.getElementById('result-overlay').classList.remove('visible');
}

function partialUpcSearch(query) {
  const cleaned = query.replace(/[^0-9]/g, '');
  if (!cleaned) return [];
  // Exact match first
  const exact = findProduct(cleaned);
  if (exact) return [exact];
  // Partial: search all products whose UPC contains the query
  // Prioritize matches at the END of the UPC (last digits)
  const endMatches = [];
  const containsMatches = [];
  PRODUCTS.forEach(p => {
    if (p.upc.endsWith(cleaned)) {
      endMatches.push(p);
    } else if (p.upc.includes(cleaned)) {
      containsMatches.push(p);
    }
  });
  // End-matches first, then other contains-matches
  return [...endMatches, ...containsMatches];
}

function renderSearchResults(results, query) {
  const container = document.getElementById('search-results');
  if (!results.length) {
    container.innerHTML = '<div class="search-no-results">No products found matching "' + query + '"</div>';
    container.classList.add('visible');
    return;
  }
  const cleaned = query.replace(/[^0-9]/g, '');
  let html = '<div class="search-results-header">' + results.length + ' product' + (results.length > 1 ? 's' : '') + ' found</div>';
  results.forEach(p => {
    const displayUpc = p.upc.replace(/^0+/, '');
    // Highlight the matching portion in the UPC
    const matchIdx = displayUpc.lastIndexOf(cleaned);
    let upcHtml;
    if (matchIdx >= 0) {
      upcHtml = displayUpc.substring(0, matchIdx) +
        '<span class="upc-match">' + displayUpc.substring(matchIdx, matchIdx + cleaned.length) + '</span>' +
        displayUpc.substring(matchIdx + cleaned.length);
    } else {
      // Match might be in the leading-zero version
      const fullMatchIdx = p.upc.lastIndexOf(cleaned);
      if (fullMatchIdx >= 0) {
        upcHtml = '<span class="upc-match">' + displayUpc + '</span>';
      } else {
        upcHtml = displayUpc;
      }
    }
    // Product image
    const paddedUpc = p.upc.padStart(13, '0');
    const imgHtml = '<img src="' + paddedUpc + '.webp" alt="" onerror="this.outerHTML=\'<span class=\\\'mini-placeholder\\\'>\\u2600\\ufe0f</span>\'">';
    html += '<div class="search-result-item" onclick="selectSearchResult(\'' + p.upc + '\')">' +
      '<div class="search-result-img">' + imgHtml + '</div>' +
      '<div class="search-result-info">' +
        '<div class="search-result-name">' + p.name + '</div>' +
        '<div class="search-result-upc">' + upcHtml + '</div>' +
      '</div>' +
      '<div class="search-result-loc">S' + p.segment + ' / Sh' + p.shelf + ' / P' + p.position + '</div>' +
    '</div>';
  });
  container.innerHTML = html;
  container.classList.add('visible');
}

function selectSearchResult(upc) {
  hideSearchResults();
  document.getElementById('upc-input').value = '';
  showProduct(upc);
}

function hideSearchResults() {
  document.getElementById('search-results').classList.remove('visible');
}

function lookupUPC() {
  const input = document.getElementById('upc-input');
  const upc = input.value.trim();
  if (!upc) return;
  const cleaned = upc.replace(/[^0-9]/g, '');
  // Try exact match first
  const exact = findProduct(cleaned);
  if (exact) {
    hideSearchResults();
    input.value = '';
    showProduct(upc);
    return;
  }
  // Partial search
  const results = partialUpcSearch(upc);
  if (results.length === 1) {
    // Single match - go directly to product
    hideSearchResults();
    input.value = '';
    showProduct(results[0].upc);
    return;
  }
  // Multiple matches or no matches - show results list
  renderSearchResults(results, upc);
}

// Scanner
async function toggleScanner() {
  if (scannerRunning) {
    stopScanner();
  } else {
    startScanner();
  }
}

async function startScanner() {
  const statusEl = document.getElementById('scanner-status');
  const toggleBtn = document.getElementById('scanner-toggle');

  try {
    if (!scanner) {
      scanner = new Html5Qrcode("scanner-container");
    }
    statusEl.textContent = 'Starting camera...';
    await scanner.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: { width: 280, height: 150 },
        formatsToSupport: [
          Html5QrcodeSupportedFormats.UPC_A,
          Html5QrcodeSupportedFormats.UPC_E,
          Html5QrcodeSupportedFormats.EAN_13,
          Html5QrcodeSupportedFormats.EAN_8,
          Html5QrcodeSupportedFormats.CODE_128
        ]
      },
      (text) => {
        // Success
        if (navigator.vibrate) navigator.vibrate(100);
        showProduct(text);
      },
      () => {} // Ignore scan failures
    );
    scannerRunning = true;
    statusEl.textContent = 'Point camera at barcode';
    toggleBtn.textContent = 'Stop Camera';
    toggleBtn.classList.remove('primary');
  } catch (e) {
    statusEl.textContent = 'Camera access denied. Check permissions.';
    console.error(e);
  }
}

async function stopScanner() {
  const statusEl = document.getElementById('scanner-status');
  const toggleBtn = document.getElementById('scanner-toggle');
  try {
    if (scanner && scannerRunning) {
      await scanner.stop();
    }
  } catch(e) {}
  scannerRunning = false;
  statusEl.textContent = 'Scanner stopped';
  toggleBtn.textContent = 'Start Camera';
  toggleBtn.classList.add('primary');
}

// Keyboard shortcut
document.getElementById('upc-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') lookupUPC();
  if (e.key === 'Escape') hideSearchResults();
});

// Live partial search as user types
document.getElementById('upc-input').addEventListener('input', e => {
  const val = e.target.value.trim();
  const cleaned = val.replace(/[^0-9]/g, '');
  if (cleaned.length < 3) {
    hideSearchResults();
    return;
  }
  const results = partialUpcSearch(val);
  renderSearchResults(results, val);
});

// Result overlay close on background tap
document.getElementById('result-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('result-overlay')) closeResult();
});

// Scroll to top button
window.addEventListener('scroll', () => {
  document.getElementById('scroll-top').classList.toggle('visible', window.scrollY > 400);
});

// Store ‚Üí Planogram mapping

// ==================== PDF Viewer ====================
var pdfDoc = null;
var pdfCurrentPage = 1;
var pdfTotalPages = 0;
var pdfZoomScale = 1.0;
var PDF_ZOOM_MIN = 0.5;
var PDF_ZOOM_MAX = 3.0;
var PDF_ZOOM_STEP = 0.25;
var pdfSearchMatches = [];
var pdfSearchIndex = -1;
var pdfSearchTimer = null;
var pdfTextContent = {};
var pdfRenderTask = null;

function openPdfViewer() {
  if (!activePlanogram || !activePlanogram.pdfFile) return;
  var overlay = document.getElementById('pdf-overlay');
  overlay.classList.add('visible');
  document.getElementById('pdf-title').textContent = activePlanogram.name + ' Planogram';
  document.getElementById('pdf-loading').style.display = 'flex';
  document.getElementById('pdf-canvas').style.display = 'none';
  document.getElementById('pdf-search-input').value = '';
  document.getElementById('pdf-search-count').textContent = '';
  document.getElementById('pdf-search-highlights').innerHTML = '';
  pdfSearchMatches = [];
  pdfSearchIndex = -1;
  pdfTextContent = {};
  pdfZoomScale = 1.0;
  document.getElementById('pdf-zoom-level').textContent = '100%';
  document.body.style.overflow = 'hidden';

  pdfjsLib.getDocument(activePlanogram.pdfFile).promise.then(function(pdf) {
    pdfDoc = pdf;
    pdfTotalPages = pdf.numPages;
    pdfCurrentPage = 1;
    renderPdfPage(pdfCurrentPage);
  }).catch(function(err) {
    console.error('PDF load error:', err);
    document.getElementById('pdf-loading').innerHTML =
      '<div style="color:#ff6b6b;font-size:14px;">Failed to load PDF</div>';
  });
}

function closePdfViewer() {
  document.getElementById('pdf-overlay').classList.remove('visible');
  document.body.style.overflow = '';
  if (pdfRenderTask) { try { pdfRenderTask.cancel(); } catch(e) {} pdfRenderTask = null; }
  pdfDoc = null;
  pdfSearchMatches = [];
  pdfSearchIndex = -1;
  pdfTextContent = {};
  document.getElementById('pdf-search-highlights').innerHTML = '';
}

function renderPdfPage(pageNum) {
  if (!pdfDoc) return;
  document.getElementById('pdf-page-info').textContent = pageNum + ' / ' + pdfTotalPages;
  document.getElementById('pdf-prev-btn').disabled = (pageNum <= 1);
  document.getElementById('pdf-next-btn').disabled = (pageNum >= pdfTotalPages);

  pdfDoc.getPage(pageNum).then(function(page) {
    var canvas = document.getElementById('pdf-canvas');
    var ctx = canvas.getContext('2d');
    var container = document.getElementById('pdf-canvas-container');
    var containerWidth = container.clientWidth - 16;
    var viewport = page.getViewport({ scale: 1 });
    var baseScale = containerWidth / viewport.width;
    var finalScale = baseScale * pdfZoomScale;
    var scaledViewport = page.getViewport({ scale: finalScale });

    var dpr = window.devicePixelRatio || 1;
    canvas.width = scaledViewport.width * dpr;
    canvas.height = scaledViewport.height * dpr;
    canvas.style.width = scaledViewport.width + 'px';
    canvas.style.height = scaledViewport.height + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

    if (pdfRenderTask) { try { pdfRenderTask.cancel(); } catch(e) {} }
    pdfRenderTask = page.render({ canvasContext: ctx, viewport: scaledViewport });

    pdfRenderTask.promise.then(function() {
      pdfRenderTask = null;
      document.getElementById('pdf-loading').style.display = 'none';
      canvas.style.display = 'block';
      container.scrollTop = 0;

      // Extract text content for search
      page.getTextContent().then(function(textContent) {
        pdfTextContent[pageNum] = { items: textContent.items, viewport: scaledViewport, finalScale: finalScale };
        if (document.getElementById('pdf-search-input').value.trim()) {
          applyPdfSearchHighlights();
        }
      });
    }).catch(function(err) {
      if (err && err.name !== 'RenderingCancelled') console.error('PDF render error:', err);
    });
  });
}

function pdfPrevPage() {
  if (pdfCurrentPage <= 1) return;
  pdfCurrentPage--;
  renderPdfPage(pdfCurrentPage);
}

function pdfNextPage() {
  if (pdfCurrentPage >= pdfTotalPages) return;
  pdfCurrentPage++;
  renderPdfPage(pdfCurrentPage);
}

function pdfZoomIn() {
  if (pdfZoomScale >= PDF_ZOOM_MAX) return;
  pdfZoomScale = Math.min(PDF_ZOOM_MAX, +(pdfZoomScale + PDF_ZOOM_STEP).toFixed(2));
  document.getElementById('pdf-zoom-level').textContent = Math.round(pdfZoomScale * 100) + '%';
  renderPdfPage(pdfCurrentPage);
}

function pdfZoomOut() {
  if (pdfZoomScale <= PDF_ZOOM_MIN) return;
  pdfZoomScale = Math.max(PDF_ZOOM_MIN, +(pdfZoomScale - PDF_ZOOM_STEP).toFixed(2));
  document.getElementById('pdf-zoom-level').textContent = Math.round(pdfZoomScale * 100) + '%';
  renderPdfPage(pdfCurrentPage);
}

function pdfSearchDebounce() {
  clearTimeout(pdfSearchTimer);
  pdfSearchTimer = setTimeout(executePdfSearch, 300);
}

function executePdfSearch() {
  var query = document.getElementById('pdf-search-input').value.trim().toLowerCase();
  pdfSearchMatches = [];
  pdfSearchIndex = -1;
  document.getElementById('pdf-search-highlights').innerHTML = '';

  if (!query || !pdfDoc) {
    document.getElementById('pdf-search-count').textContent = '';
    return;
  }

  var pagesSearched = 0;
  for (var pg = 1; pg <= pdfTotalPages; pg++) {
    (function(pageNum) {
      pdfDoc.getPage(pageNum).then(function(page) {
        return page.getTextContent();
      }).then(function(textContent) {
        var pageText = textContent.items.map(function(item) { return item.str; }).join(' ').toLowerCase();
        if (pageText.indexOf(query) >= 0) {
          pdfSearchMatches.push({ page: pageNum });
        }
        pagesSearched++;
        if (pagesSearched === pdfTotalPages) {
          pdfSearchMatches.sort(function(a, b) { return a.page - b.page; });
          var total = pdfSearchMatches.length;
          if (total === 0) {
            document.getElementById('pdf-search-count').textContent = 'No matches';
          } else {
            pdfSearchIndex = 0;
            document.getElementById('pdf-search-count').textContent = '1 / ' + total + ' pg';
            pdfCurrentPage = pdfSearchMatches[0].page;
            renderPdfPage(pdfCurrentPage);
          }
        }
      });
    })(pg);
  }
}

function applyPdfSearchHighlights() {
  var query = document.getElementById('pdf-search-input').value.trim().toLowerCase();
  var container = document.getElementById('pdf-search-highlights');
  container.innerHTML = '';

  var data = pdfTextContent[pdfCurrentPage];
  if (!query || !data) return;

  var canvas = document.getElementById('pdf-canvas');
  var viewport = data.viewport;

  data.items.forEach(function(item) {
    if (item.str.toLowerCase().indexOf(query) >= 0) {
      var tx = pdfjsLib.Util.transform(viewport.transform, item.transform);
      var x = tx[4];
      var y = tx[5] - item.height * data.finalScale;
      var w = item.width * data.finalScale;
      var h = item.height * data.finalScale;
      var div = document.createElement('div');
      div.className = 'pdf-search-highlight';
      div.style.left = x + 'px';
      div.style.top = y + 'px';
      div.style.width = w + 'px';
      div.style.height = h + 'px';
      container.appendChild(div);
    }
  });

  container.style.width = canvas.style.width;
  container.style.height = canvas.style.height;
  container.style.left = canvas.offsetLeft + 'px';
  container.style.top = canvas.offsetTop + 'px';
}

function pdfSearchNext() {
  if (pdfSearchMatches.length === 0) return;
  pdfSearchIndex = (pdfSearchIndex + 1) % pdfSearchMatches.length;
  document.getElementById('pdf-search-count').textContent =
    (pdfSearchIndex + 1) + ' / ' + pdfSearchMatches.length + ' pg';
  pdfCurrentPage = pdfSearchMatches[pdfSearchIndex].page;
  renderPdfPage(pdfCurrentPage);
}

function pdfSearchPrev() {
  if (pdfSearchMatches.length === 0) return;
  pdfSearchIndex = (pdfSearchIndex - 1 + pdfSearchMatches.length) % pdfSearchMatches.length;
  document.getElementById('pdf-search-count').textContent =
    (pdfSearchIndex + 1) + ' / ' + pdfSearchMatches.length + ' pg';
  pdfCurrentPage = pdfSearchMatches[pdfSearchIndex].page;
  renderPdfPage(pdfCurrentPage);
}

// Swipe navigation for PDF viewer
(function() {
  var pdfStartX = 0, pdfStartY = 0, pdfTracking = false, pdfSwiped = false;
  var PDF_THRESHOLD = 80;
  var PDF_VERTICAL_LOCK = 30;
  var el = document.getElementById('pdf-canvas-container');

  el.addEventListener('touchstart', function(e) {
    if (!pdfDoc) return;
    pdfStartX = e.touches[0].clientX;
    pdfStartY = e.touches[0].clientY;
    pdfTracking = true;
    pdfSwiped = false;
  }, { passive: true });

  el.addEventListener('touchmove', function(e) {
    if (!pdfDoc || !pdfTracking || pdfSwiped) return;
    var dx = e.touches[0].clientX - pdfStartX;
    var dy = e.touches[0].clientY - pdfStartY;
    if (Math.abs(dy) > PDF_VERTICAL_LOCK && Math.abs(dy) > Math.abs(dx)) {
      pdfTracking = false;
      return;
    }
    if (dx > PDF_THRESHOLD && pdfCurrentPage > 1) {
      pdfSwiped = true;
      pdfPrevPage();
    } else if (dx < -PDF_THRESHOLD && pdfCurrentPage < pdfTotalPages) {
      pdfSwiped = true;
      pdfNextPage();
    }
  }, { passive: true });

  el.addEventListener('touchend', function() {
    pdfTracking = false;
    pdfSwiped = false;
  }, { passive: true });
})();

// Keyboard shortcuts for PDF viewer
document.addEventListener('keydown', function(e) {
  if (!document.getElementById('pdf-overlay').classList.contains('visible')) return;
  if (e.target.tagName === 'INPUT') return;
  if (e.key === 'ArrowLeft') pdfPrevPage();
  else if (e.key === 'ArrowRight') pdfNextPage();
  else if (e.key === '+' || e.key === '=') pdfZoomIn();
  else if (e.key === '-') pdfZoomOut();
  else if (e.key === 'Escape') closePdfViewer();
});

const STORE_MAP = {
  "00005":"pallet","00011":"pallet","00013":"pallet","00017":"pallet","00018":"pallet",
  "00019":"pallet","00021":"endcap","00023":"pallet","00024":"pallet","00025":"pallet",
  "00028":"pallet","00030":"pallet","00031":"pallet","00035":"pallet","00040":"endcap",
  "00041":"pallet","00049":"pallet","00050":"pallet","00060":"pallet","00063":"pallet",
  "00070":"pallet","00071":"endcap","00075":"pallet","00090":"pallet","00093":"pallet",
  "00111":"pallet","00122":"pallet","00125":"pallet","00126":"pallet","00127":"pallet",
  "00135":"endcap","00140":"pallet","00143":"pallet","00150":"pallet","00153":"pallet",
  "00156":"pallet","00158":"pallet","00163":"pallet","00165":"pallet","00171":"pallet",
  "00180":"pallet","00185":"pallet","00186":"pallet","00195":"pallet","00196":"pallet",
  "00198":"pallet","00208":"pallet","00209":"pallet","00210":"pallet","00214":"pallet",
  "00215":"pallet","00218":"pallet","00220":"pallet","00224":"endcap","00225":"pallet",
  "00226":"pallet","00227":"pallet","00236":"pallet","00240":"pallet","00242":"pallet",
  "00255":"endcap","00260":"pallet","00265":"pallet","00281":"endcap","00285":"pallet",
  "00286":"pallet","00325":"pallet","00328":"pallet","00351":"pallet","00355":"pallet",
  "00360":"endcap","00372":"endcap","00375":"pallet","00377":"pallet","00383":"pallet",
  "00390":"pallet","00391":"pallet","00393":"pallet","00417":"pallet","00424":"pallet",
  "00439":"pallet","00449":"pallet","00457":"pallet","00458":"endcap","00459":"pallet",
  "00460":"pallet","00462":"pallet","00464":"endcap","00482":"pallet","00485":"pallet",
  "00486":"pallet","00516":"pallet","00600":"pallet","00603":"endcap","00604":"endcap",
  "00605":"endcap","00608":"pallet","00613":"pallet","00614":"pallet","00615":"pallet",
  "00649":"pallet","00650":"pallet","00651":"pallet","00652":"pallet","00653":"pallet",
  "00654":"pallet","00655":"pallet","00656":"pallet","00657":"pallet","00658":"pallet",
  "00659":"pallet","00660":"pallet","00661":"pallet","00662":"pallet","00663":"endcap",
  "00665":"pallet","00667":"pallet","00668":"pallet","00681":"pallet","00682":"pallet",
  "00683":"pallet","00685":"pallet","00688":"pallet","00691":"endcap","00694":"pallet"
};

let selectedStore = null;

function onStoreSelect(storeNum) {
  if (!storeNum) return;
  selectedStore = storeNum;
  const pogId = STORE_MAP[storeNum];
  const pog = PLANOGRAMS[pogId];
  const preview = document.getElementById('selector-preview');
  document.getElementById('preview-name').textContent = pog.name;
  document.getElementById('preview-sub').innerHTML = pog.subtitle + '<br>' + pog.pogNumber;
  document.getElementById('preview-stats').innerHTML =
    '<div class="selector-stat"><strong>' + pog.products.length + '</strong>SKUs</div>' +
    '<div class="selector-stat"><strong>' + pog.sides + '</strong>Side' + (pog.sides > 1 ? 's' : '') + '</div>' +
    '<div class="selector-stat"><strong>' + pog.shelves + '</strong>Shelves</div>';
  preview.classList.remove('hidden');
}

function confirmStoreSelect() {
  if (!selectedStore) return;
  const pogId = STORE_MAP[selectedStore];
  selectPlanogram(pogId);
}

// Planogram selection
function selectPlanogram(id) {
  activePlanogram = PLANOGRAMS[id];
  PRODUCTS = activePlanogram.products;
  buildUpcIndex();
  currentSegment = 1;
  currentFilter = 'all';
  currentMode = 'browse';

  // Update header
  const storeLabel = selectedStore ? 'Store ' + selectedStore + ' ¬∑ ' : '';
  document.getElementById('header-subtitle').textContent =
    storeLabel + activePlanogram.pogNumber + ' ¬∑ ' + activePlanogram.subtitle;
  document.getElementById('header-pog-info').innerHTML =
    'LIVE ' + activePlanogram.liveDate + '<br>' +
    activePlanogram.products.length + ' SKUs ¬∑ ' + activePlanogram.sides + (activePlanogram.sides > 1 ? ' Sides' : ' Side');

  // Update title
  document.title = 'Suncare POG Lookup ‚Äî ' + activePlanogram.pogNumber;

  // Show/hide bottom nav based on sides
  document.getElementById('bottom-nav').style.display = activePlanogram.sides > 1 ? 'flex' : 'none';

  // Transition screens
  document.getElementById('selector-screen').classList.add('hidden');
  document.getElementById('app-content').classList.remove('hidden');

  // Reset mode UI
  document.querySelectorAll('.mode-tab').forEach(t => t.classList.toggle('active', t.dataset.mode === 'browse'));
  document.getElementById('browse-section').style.display = '';
  document.getElementById('scanner-section').style.display = 'none';
  document.getElementById('search-bar').style.display = 'none';

  renderBrowse();
  window.scrollTo(0, 0);
}

function showSelector() {
  // Stop scanner if running
  if (scanner) { try { scanner.stop(); } catch(e) {} scanner = null; }
  document.getElementById('app-content').classList.add('hidden');
  document.getElementById('selector-screen').classList.remove('hidden');
  document.getElementById('store-select').value = '';
  document.getElementById('selector-preview').classList.add('hidden');
  selectedStore = null;
  activePlanogram = null;
  PRODUCTS = [];
}

// Init ‚Äî populate dropdown and show selector screen
(function() {
  const sel = document.getElementById('store-select');
  Object.keys(STORE_MAP).sort().forEach(s => {
    const opt = document.createElement('option');
    opt.value = s;
    opt.textContent = 'Store ' + s;
    sel.appendChild(opt);
  });
})();
</script>
</body>
</html>
